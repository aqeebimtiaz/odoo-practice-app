
/* /web_editor/static/lib/nearest/jquery.nearest.js defined in bundle 'web_editor.assets_editor' */
;(function($,undefined){var rPerc=/^([\d.]+)%$/;function nearest(selector,options,thisObj){selector||(selector='div');var $container=$(options.container),containerOffset=$container.offset()||{left:0,top:0},containerDims=[containerOffset.left+$container.width(),containerOffset.top+$container.height()],percProps={x:0,y:1,w:0,h:1},prop,match;for(prop in percProps)if(percProps.hasOwnProperty(prop)){match=rPerc.exec(options[prop]);if(match){options[prop]=containerDims[percProps[prop]]*match[1]/100;}}
var $all=$(selector),cache=[],furthest=!!options.furthest,checkX=!!options.checkHoriz,checkY=!!options.checkVert,compDist=furthest?0:Infinity,point1x=parseFloat(options.x)||0,point1y=parseFloat(options.y)||0,point2x=parseFloat(point1x+options.w)||point1x,point2y=parseFloat(point1y+options.h)||point1y,tolerance=options.tolerance||0,hasEach2=!!$.fn.each2,min=Math.min,max=Math.max;if(!options.includeSelf&&thisObj){$all=$all.not(thisObj);}
if(tolerance<0){tolerance=0;}
$all[hasEach2?'each2':'each'](function(i,elem){var $this=hasEach2?elem:$(this),off=$this.offset(),x=off.left,y=off.top,w=$this.outerWidth(),h=$this.outerHeight(),x2=x+w,y2=y+h,maxX1=max(x,point1x),minX2=min(x2,point2x),maxY1=max(y,point1y),minY2=min(y2,point2y),intersectX=minX2>=maxX1,intersectY=minY2>=maxY1,distX,distY,distT,isValid;if((checkX&&checkY)||(!checkX&&!checkY&&intersectX&&intersectY)||(checkX&&intersectY)||(checkY&&intersectX)){distX=intersectX?0:maxX1-minX2;distY=intersectY?0:maxY1-minY2;distT=intersectX||intersectY?max(distX,distY):Math.sqrt(distX*distX+distY*distY);isValid=furthest?distT>=compDist-tolerance:distT<=compDist+tolerance;if(isValid){compDist=furthest?max(compDist,distT):min(compDist,distT);cache.push({node:this,dist:distT});}}});var len=cache.length,filtered=[],compMin,compMax,i,item;if(len){if(furthest){compMin=compDist-tolerance;compMax=compDist;}else{compMin=compDist;compMax=compDist+tolerance;}
for(i=0;i<len;i++){item=cache[i];if(item.dist>=compMin&&item.dist<=compMax){filtered.push(item.node);}}}
return filtered;}
$.each(['nearest','furthest','touching'],function(i,name){var defaults={x:0,y:0,w:0,h:0,tolerance:1,container:document,furthest:name=='furthest',includeSelf:false,checkHoriz:name!='touching',checkVert:name!='touching'};$[name]=function(point,selector,options){if(!point||point.x===undefined||point.y===undefined){return $([]);}
var opts=$.extend({},defaults,point,options||{});return $(nearest(selector,opts));};$.fn[name]=function(selector,options){var opts;if(selector&&$.isPlainObject(selector)){opts=$.extend({},defaults,selector,options||{});return this.pushStack(nearest(this,opts));}
var offset=this.offset(),dimensions={x:offset.left,y:offset.top,w:this.outerWidth(),h:this.outerHeight()};opts=$.extend({},defaults,dimensions,options||{});return this.pushStack(nearest(selector,opts,this));};});})(jQuery);;

/* /web_editor/static/src/js/editor.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.editor',function(require){"use strict";var ajax=require('web.ajax');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var core=require('web.core');var base=require('web_editor.base');var rte=require('web_editor.rte');var qweb=core.qweb;var _t=core._t;var editor={};editor.dummy=function(){return true;};editor.editable=!!($('html').data('editable')||$("[data-oe-model]").length);ajax.loadXML('/web_editor/static/src/xml/editor.xml',qweb);$(document).on('click','.note-editable',function(ev){ev.preventDefault();});$(document).on('submit','.note-editable form .btn',function(ev){ev.preventDefault();});$(document).on('hide.bs.dropdown','.dropdown',function(ev){if(ev.originalEvent&&$(ev.target).has(ev.originalEvent.target).length&&$(ev.originalEvent.target).is('[contenteditable]')){ev.preventDefault();}});editor.reload=function(){location.hash="scrollTop="+window.document.body.scrollTop;if(location.search.indexOf("enable_editor")>-1){window.location.href=window.location.href.replace(/&?enable_editor(=[^&]*)?/g,'');}else{window.location.reload(true);}};base.ready().then(function(){if(editor.editable&&location.search.indexOf("enable_editor")>=0){editor.editor_bar=new editor.Class();editor.editor_bar.prependTo(document.body);}});editor.Class=Widget.extend({template:'web_editor.editorbar',events:{'click button[data-action=save]':'save','click button[data-action=cancel]':'cancel',},init:function(parent){var self=this;var res=this._super.apply(this,arguments);this.parent=parent;this.rte=new rte.Class(this);this.rte.on('rte:start',this,function(){self.trigger('rte:start');});return res;},start:function(){$('.dropdown-toggle').dropdown();this.display_placeholder();this.rte.on('change',this,this.proxy('rte_changed'));this.rte.start();var flag=false;window.onbeforeunload=function(event){if(rte.history.getEditableHasUndo().length&&!flag){flag=true;_.defer(function(){flag=false;});return _t('This document is not saved!');}};return this._super.apply(this,arguments);},display_placeholder:function(){var $area=$("#wrapwrap").find("[data-oe-model] .oe_structure.oe_empty, [data-oe-model].oe_structure.oe_empty, [data-oe-type=html]").filter(".oe_not_editable").filter(".oe_no_empty");this.on('rte:start',this,function(){$area.attr("data-oe-placeholder",_t("Write Your Text Here"));});this.on("snippets:ready",this,function(){if($("body").hasClass("editor_has_snippets")){$area.attr("data-oe-placeholder",_t("Write Your Text or Drag a Block Here"));}});$(document).on("keyup",function(event){if((event.keyCode===8||event.keyCode===46)){var $target=$(event.target).closest(".o_editable");if(!$target.is(":has(*:not(p):not(br))")&&!$target.text().match(/\S/)){$target.empty();}}});},rte_changed:function(){},save:function(){return this.rte.save().then(function(){editor.reload();});},save_without_reload:function(){return this.rte.save();},cancel:function(){return new $.Deferred(function(d){if(!rte.history.getEditableHasUndo().length){return d.resolve();}
var confirm=Dialog.confirm(null,_t("If you discard the current edition, all unsaved changes will be lost. You can cancel to return to the edition mode."),{confirm_callback:d.resolve.bind(d)});confirm.on("closed",d,d.reject);}).then(function(){window.onbeforeunload=null;editor.reload();});},});return editor;});;

/* /web_editor/static/src/js/rte.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.rte',function(require){'use strict';var ajax=require('web.ajax');var core=require('web.core');var utils=require('web.utils');var Widget=require('web.Widget');var summernote=require('web_editor.summernote');var base=require('web_editor.base');var _t=core._t;var dom=summernote.core.dom;var range=summernote.core.range;var History=function History($editable){var aUndo=[];var pos=0;this.makeSnap=function(event,rng){rng=rng||range.create();var elEditable=$(rng&&rng.sc).closest('.o_editable')[0];if(!elEditable){return false;}
return{event:event,editable:elEditable,contents:elEditable.innerHTML,bookmark:rng&&rng.bookmark(elEditable),scrollTop:$(elEditable).scrollTop()};};this.applySnap=function(oSnap){var $editable=$(oSnap.editable);if(document.documentMode){$editable.removeAttr("contentEditable").removeProp("contentEditable");}
$editable.html(oSnap.contents).scrollTop(oSnap.scrollTop);$(".oe_overlay").remove();$(".note-control-selection").hide();$editable.trigger("content_changed");try{var r=oSnap.editable.innerHTML===""?range.create(oSnap.editable,0):range.createFromBookmark(oSnap.editable,oSnap.bookmark);r.select();}catch(e){console.error(e);return;}
$(document).trigger("click");$(".o_editable *").filter(function(){var $el=$(this);if($el.data('snippet-editor')){$el.removeData();}});_.defer(function(){var target=dom.isBR(r.sc)?r.sc.parentNode:dom.node(r.sc);if(!target){return;}
$editable.trigger("applySnap");var evt=document.createEvent("MouseEvents");evt.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,target);target.dispatchEvent(evt);$editable.trigger("keyup");});};this.undo=function(){if(!pos){return;}
var _toSnap=toSnap;if(_toSnap){this.saveSnap();}
if(!aUndo[pos]&&(!aUndo[pos]||aUndo[pos].event!=='undo')){var temp=this.makeSnap('undo');if(temp&&(!pos||temp.contents!==aUndo[pos-1].contents)){aUndo[pos]=temp;}else{pos--;}}else if(_toSnap){pos--;}
this.applySnap(aUndo[Math.max(--pos,0)]);while(pos&&(aUndo[pos].event==="blur"||(aUndo[pos+1].editable===aUndo[pos].editable&&aUndo[pos+1].contents===aUndo[pos].contents))){this.applySnap(aUndo[--pos]);}};this.hasUndo=function(){return(toSnap&&(toSnap.event!=="blur"&&toSnap.event!=="activate"&&toSnap.event!=="undo"))||!!_.find(aUndo.slice(0,pos+1),function(undo){return undo.event!=="blur"&&undo.event!=="activate"&&undo.event!=="undo";});};this.getEditableHasUndo=function(){var editable=[];if((toSnap&&(toSnap.event!=="blur"&&toSnap.event!=="activate"&&toSnap.event!=="undo"))){editable.push(toSnap.editable);}
_.each(aUndo.slice(0,pos+1),function(undo){if(undo.event!=="blur"&&undo.event!=="activate"&&undo.event!=="undo"){editable.push(undo.editable);}});return _.uniq(editable);};this.redo=function(){if(!aUndo[pos+1]){return;}
this.applySnap(aUndo[++pos]);while(aUndo[pos+1]&&aUndo[pos].event==="active"){this.applySnap(aUndo[pos++]);}};this.hasRedo=function(){return aUndo.length>pos+1;};var toSnap;this.recordUndo=function($editable,event,internal_history){var self=this;if(!$editable){var rng=range.create();if(!rng)return;$editable=$(rng.sc).closest(".o_editable");}
if(aUndo[pos]&&(event==="applySnap"||event==="activate")){return;}
if(!internal_history){if(!event||!toSnap||!aUndo[pos-1]||toSnap.event==="activate"){setTimeout(function(){$editable.trigger("content_changed");},0);}}
if(aUndo[pos]){pos=Math.min(pos,aUndo.length);aUndo.splice(pos,aUndo.length);}
if(toSnap&&(toSnap.split||!event||toSnap.event!==event||toSnap.editable!==$editable[0])){this.saveSnap();}
if(pos&&aUndo[pos-1].editable!==$editable[0]){var snap=this.makeSnap('blur',range.create(aUndo[pos-1].editable,0));pos++;aUndo.push(snap);}
if(range.create()){toSnap=self.makeSnap(event);}else{toSnap=false;}};this.splitNext=function(){if(toSnap){toSnap.split=true;}};this.saveSnap=function(){if(toSnap){if(!aUndo[pos]){pos++;}
aUndo.push(toSnap);delete toSnap.split;toSnap=null;}};};var history=new History();$.extend($.expr[':'],{o_editable:function(node,i,m){while(node){if(node.className&&_.isString(node.className)){if(node.className.indexOf('o_not_editable')!==-1){return false;}
if(node.className.indexOf('o_editable')!==-1){return true;}}
node=node.parentNode;}
return false;}});$.fn.extend({focusIn:function(){if(this.length){range.create(dom.firstChild(this[0]),0).select();}
return this;},focusInEnd:function(){if(this.length){var last=dom.lastChild(this[0]);range.create(last,dom.nodeLength(last)).select();}
return this;},selectContent:function(){if(this.length){var next=dom.lastChild(this[0]);range.create(dom.firstChild(this[0]),0,next,next.textContent.length).select();}
return this;}});var RTE=Widget.extend({init:function(EditorBar,config){var self=this;this.EditorBar=EditorBar;data.rte=this;this._super.apply(this,arguments);this.init_bootstrap_carousel=$.fn.carousel;this.edit_bootstrap_carousel=function(){var res=self.init_bootstrap_carousel.apply(this,arguments);$(this).off('keydown.bs.carousel');return res;};if(config){this.config=config;}},historyRecordUndo:function($target,event,internal_history){$target=$($target);var rng=range.create();var $editable=$(rng&&rng.sc).closest(".o_editable");if(!rng||!$editable.length){$editable=$target.closest(".o_editable");rng=range.create($target.closest("*")[0],0);}else{rng=$editable.data('range')||rng;}
try{rng.select();}catch(e){console.log('error',e);}
history.recordUndo($editable,event,internal_history);},start:function(){var self=this;this.saving_mutex=new utils.Mutex();$.fn.carousel=this.edit_bootstrap_carousel;$(document).on("keydown.rte",this,this.onKeydown.bind(this));$(document).on("mousedown.rte activate.rte",this,this.onMousedown.bind(this));$(document).on("mouseup.rte",this,this.onMouseup.bind(this));$('.o_not_editable').attr("contentEditable",false);var $editable=this.editable();$editable.addClass('o_editable').data('rte',this).each(function(){var $node=$(this);if(window.getComputedStyle(this).display==="inline"&&$node.data('oe-type')!=="image"){$node.addClass('o_is_inline_editable');}
$node.data('initInnerHTML',$node.html());});$(document).on('content_changed','.o_editable',function(ev){self.trigger('change',this);if(!ev.__isDirtyHandled){$(this).addClass('o_dirty');ev.__isDirtyHandled=true;}});$('#wrapwrap, .o_editable').on('click.rte','*',this,this.onClick.bind(this));$('body').addClass("editor_enable");$(document).tooltip({selector:'[data-oe-readonly]',container:'body',trigger:'hover',delay:{"show":1000,"hide":100},placement:'bottom',title:_t("Readonly field")}).on('click',function(){$(this).tooltip('hide');});$(document).trigger('mousedown');this.trigger('rte:start');},save:function(context){var self=this;this.__saved={};$('.o_editable').destroy().removeClass('o_editable o_is_inline_editable');var defs=$('.o_dirty').removeAttr('contentEditable').removeClass('o_dirty oe_carlos_danger o_is_inline_editable').map(function(){var $el=$(this);$el.find('[class]').filter(function(){if(!this.getAttribute('class').match(/\S/)){this.removeAttribute('class');}});return self.saving_mutex.exec(function(){return self.saveElement($el,context).then(undefined,function(thing,response){var id=_.uniqueId('carlos_danger_');$el.addClass('o_dirty oe_carlos_danger '+id);return $.Deferred().reject({id:id,error:response.data,});});});}).get();return $.when.apply(null,defs).then(function(){window.onbeforeunload=null;},function(failed){self.stop();self.start();if(!_.isArray(failed)){failed=[failed];}
_(failed).each(function(failure){var html=failure.error.exception_type==="except_osv";if(html){var msg=$("<div/>").text(failure.error.message).html();var data=msg.substring(3,msg.length-2).split(/', u'/);failure.error.message='<b>'+data[0]+'</b>'+data[1];}
$('.o_editable.'+failure.id).removeClass(failure.id).popover({html:html,trigger:'hover',content:failure.error.message,placement:'auto top',}).popover('show');});});},getEscapedElement:function($el){var escaped_el=$el.clone();var to_escape=escaped_el.find('*').addBack();to_escape=to_escape.not(to_escape.filter('object,iframe,script,style,[data-oe-model][data-oe-model!="ir.ui.view"]').find('*').addBack());to_escape.contents().each(function(){if(this.nodeType===3){this.nodeValue=$('<div />').text(this.nodeValue).html();}});return escaped_el;},saveElement:function($el,context){if($el.data('oe-model')){var key=$el.data('oe-model')+":"+$el.data('oe-id')+":"+$el.data('oe-field')+":"+$el.data('oe-type')+":"+$el.data('oe-expression')+":"+$el.data('oe-xpath');if(this.__saved[key])return $.when();this.__saved[key]=true;}
var markup=this.getEscapedElement($el).prop('outerHTML');return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),markup,$el.data('oe-xpath')||null,_.omit(context||base.get_context(),'lang')],});},stop:function(){if(this.$last){this.$last.destroy();this.$last=null;}
$.fn.carousel=this.init_bootstrap_carousel;$(document).off(".rte");$('#wrapwrap, .o_editable').off('.rte');$('.o_not_editable').removeAttr("contentEditable");$(document).off('content_changed').removeClass('o_is_inline_editable').removeData('rte');$(document).tooltip('destroy');$('body').removeClass("editor_enable");this.trigger('rte:stop');},cancel:function(){$('.o_editable').each(function(){var $node=$(this);$node.data('initInnerHTML',$node.html());});this.stop();},onClick:function(e){e.preventDefault();},onKeydown:function(event){if(event.keyCode===27&&!$('.modal-content:visible').length){_.defer(function(){$('#editor-top-navbar [data-action="cancel"]').click();var $modal=$('.modal-content > .modal-body').parents(".modal:first");$modal.off('keyup.dismiss.bs.modal');_.delay(function(){$modal.on('keyup.dismiss.bs.modal',function(){$(this).modal('hide');});},500);});}},onMousedown:function(event){var $target=$(event.target);var $editable=$target.closest('.o_editable');if(!$editable.length){return;}
_.defer(function(){$editable.find('[_moz_abspos]').removeAttr('_moz_abspos');});if($target.is('a')){$target.attr('contenteditable',true);_.defer(function(){$editable.not($target).attr('contenteditable',false);$target.focus();});$(document).on('mousedown.reactivate_contenteditable',function(e){if($target.is(e.target))return;$target.removeAttr('contenteditable');$editable.attr('contenteditable',true);$(document).off('mousedown.reactivate_contenteditable');});}
if(this&&this.$last&&(!$editable.length||this.$last[0]!==$editable[0])){var $destroy=this.$last;history.splitNext();_.delay(function(){var id=$destroy.data('note-id');$destroy.destroy().removeData('note-id').removeAttr('data-note-id');$('#note-popover-'+id+', #note-handle-'+id+', #note-dialog-'+id+'').remove();},150);this.$last=null;}
if($editable.length&&(!this.$last||this.$last[0]!==$editable[0])&&($target.closest('[contenteditable]').attr('contenteditable')||"").toLowerCase()!=='false'){$editable.summernote(this.config($editable));$editable.data('NoteHistory',history);this.$last=$editable;try{document.execCommand('enableObjectResizing',false,false);document.execCommand('enableInlineTableEditing',false,false);document.execCommand('2D-position',false,false);}catch(e){}
document.body.addEventListener('resizestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('movestart',function(evt){evt.preventDefault();return false;});document.body.addEventListener('dragstart',function(evt){evt.preventDefault();return false;});if(!range.create()){$editable.focusIn();}
if(dom.isImg($target[0])){$target.trigger('mousedown');}
this.onEnableEditableArea($editable);}},onEnableEditableArea:function($editable){},onMouseup:function(ev){var $target=$(ev.target);var $editable=$target.closest('.o_editable');if(!$editable.length){return;}
var self=this;_.defer(function(){self.historyRecordUndo($target,'activate',true);});if(ev.originalEvent.detail===3){range.create(ev.target,0,ev.target,ev.target.childNodes.length).select();}},editable:function(){return $('#wrapwrap [data-oe-model]').not('.o_not_editable').filter(function(){return!$(this).closest('.o_not_editable').length;}).not('link, script').not('[data-oe-readonly]').not('img[data-oe-field="arch"], br[data-oe-field="arch"], input[data-oe-field="arch"]').not('.oe_snippet_editor').add('.o_editable');},config:function($editable){return{'airMode':true,'focus':false,'airPopover':[['style',['style']],['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['table',['table']],['insert',['link','picture']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};},});var data={history:history,Class:RTE};return data;});;

/* /web_editor/static/src/js/rte.summernote.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.rte.summernote',function(require){'use strict';var core=require('web.core');var ajax=require('web.ajax');var base=require('web_editor.base');var widgets=require('web_editor.widget');var rte=require('web_editor.rte');var QWeb=core.qweb;var _t=core._t;ajax.jsonRpc('/web/dataset/call','call',{'model':'ir.ui.view','method':'read_template','args':['web_editor.colorpicker',base.get_context()]}).done(function(data){QWeb.add_template(data);});var dom=$.summernote.core.dom;var range=$.summernote.core.range;var eventHandler=$.summernote.eventHandler;var renderer=$.summernote.renderer;var tplButton=renderer.getTemplate().button;var tplIconButton=renderer.getTemplate().iconButton;var tplDropdown=renderer.getTemplate().dropdown;var fn_createPalette=renderer.createPalette;renderer.createPalette=function($container,options){fn_createPalette.call(this,$container,options);if(!QWeb.has_template('web_editor.colorpicker')){return;}
var $clpicker=$(QWeb.render('web_editor.colorpicker'));var groups;if($clpicker.is("colorpicker")){groups=_.map($clpicker.children(),function(el){return $(el).find("button").empty();});}else{groups=[$clpicker.find("button").empty()];}
var html="<h6>"+_t("Theme colors")+"</h6>"+_.map(groups,function($group){var $row=$("<div/>",{"class":"note-color-row mb8"}).append($group);var $after_breaks=$row.find(".o_small + :not(.o_small)");if($after_breaks.length===0){$after_breaks=$row.find(":nth-child(8n+9)");}
$after_breaks.addClass("o_clear");return $row[0].outerHTML;}).join("")+"<h6>"+_t("Common colors")+"</h6>";var $palettes=$container.find(".note-color .note-color-palette");$palettes.prepend(html);var $bg=$palettes.first().find("button:not(.note-color-btn)").addClass("note-color-btn");var $fore=$palettes.last().find("button:not(.note-color-btn)").addClass("note-color-btn");$bg.each(function(){var $el=$(this);var className='bg-'+$el.data('color');$el.attr('data-event','backColor').attr('data-value',className).addClass(className);});$fore.each(function(){var $el=$(this);var className='text-'+$el.data('color');$el.attr('data-event','foreColor').attr('data-value',className).addClass('bg-'+$el.data('color'));});};var fn_tplPopovers=renderer.tplPopovers;renderer.tplPopovers=function(lang,options){var $popover=$(fn_tplPopovers.call(this,lang,options));var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');if(window===window.top){$popover.children().addClass("hidden-xs");}
$(tplIconButton('fa fa-align-center',{title:_t('Center'),event:'floatMe',value:'center'})).insertAfter($imagePopover.find('[data-event="floatMe"][data-value="left"]'));$imagePopover.find('button[data-event="removeMedia"]').parent().remove();$imagePopover.find('button[data-event="floatMe"][data-value="none"]').remove();var $padding=$('<div class="btn-group"/>');$padding.insertBefore($imagePopover.find('.btn-group:first'));var dropdown_content=['<li><a data-event="padding" href="#" data-value="">'+_t('None')+'</a></li>','<li><a data-event="padding" href="#" data-value="small">'+_t('Small')+'</a></li>','<li><a data-event="padding" href="#" data-value="medium">'+_t('Medium')+'</a></li>','<li><a data-event="padding" href="#" data-value="large">'+_t('Large')+'</a></li>','<li><a data-event="padding" href="#" data-value="xl">'+_t('Xl')+'</a></li>',];$(tplIconButton('fa fa-plus-square-o',{title:_t('Padding'),dropdown:tplDropdown(dropdown_content)})).appendTo($padding);$imagePopover.find('[data-event="imageShape"]:not([data-value])').remove();var $button=$(tplIconButton('fa fa-sun-o',{title:_t('Shadow'),event:'imageShape',value:'shadow'})).insertAfter($imagePopover.find('[data-event="imageShape"][data-value="img-circle"]'));var $spin=$('<div class="btn-group hidden only_fa"/>').insertAfter($button.parent());$(tplIconButton('fa fa-refresh',{title:_t('Spin'),event:'imageShape',value:'fa-spin'})).appendTo($spin);var $resizefa=$('<div class="btn-group hidden only_fa"/>').insertAfter($imagePopover.find('.btn-group:has([data-event="resize"])'));for(var size=1;size<=5;size++){$(tplButton('<span class="note-fontsize-10">'+size+'x</span>',{title:size+"x",event:'resizefa',value:size+''})).appendTo($resizefa);}
var $colorfa=$airPopover.find('.note-color').clone();$colorfa.find(".btn-group:first").remove();$colorfa.find("ul.dropdown-menu").css('min-width','172px');$colorfa.find('button[data-event="color"]').attr('data-value','{"foreColor": "#f00"}').find("i").css({'background':'','color':'#f00'});$resizefa.after($colorfa);var $imageprop=$('<div class="btn-group"/>');$imageprop.appendTo($imagePopover.find('.popover-content'));$(tplIconButton('fa fa-file-image-o',{title:_t('Edit'),event:'showImageDialog'})).appendTo($imageprop);$(tplIconButton('fa fa-trash-o',{title:_t('Remove'),event:'delete'})).appendTo($imageprop);$imagePopover.find('.popover-content').append($airPopover.find(".note-history").clone());$imagePopover.find('[data-event="showImageDialog"]').before($airPopover.find('[data-event="showLinkDialog"]').clone());var $alt=$('<div class="btn-group"/>');$alt.appendTo($imagePopover.find('.popover-content'));$alt.append('<button class="btn btn-default btn-sm btn-small" data-event="alt"><strong>'+_t('Description')+': </strong><span class="o_image_alt"/></button>');$linkPopover.find('.popover-content').append($airPopover.find(".note-history").clone());$linkPopover.find('button[data-event="showLinkDialog"] i').attr("class","fa fa-link");$linkPopover.find('button[data-event="unlink"]').before($airPopover.find('button[data-event="showImageDialog"]').clone());$airPopover.find('.note-style .dropdown-toggle').on('mousedown',function(){var $format=$airPopover.find('[data-event="formatBlock"]');var node=range.create().sc;var formats=$format.map(function(){return $(this).data("value");}).get();while(node&&(!node.tagName||(!node.tagName||formats.indexOf(node.tagName.toLowerCase())===-1))){node=node.parentNode;}
$format.parent().removeClass('active');$format.filter('[data-value="'+(node?node.tagName.toLowerCase():"p")+'"]').parent().addClass("active");});setTimeout(function(){$airPopover.add($linkPopover).add($imagePopover).find("button").tooltip('destroy').tooltip({container:'body',trigger:'hover',placement:'bottom'}).on('click',function(){$(this).tooltip('hide');});});return $popover;};var fn_boutton_update=eventHandler.modules.popover.button.update;eventHandler.modules.popover.button.update=function($container,oStyle){var previous=$(".note-control-selection").data('target');if(previous){$(previous).css({"-webkit-animation-play-state":"","animation-play-state":"","-webkit-transition":"","transition":"","-webkit-animation":"","animation":""});}
fn_boutton_update.call(this,$container,oStyle);$container.find('.note-color').removeClass("hidden");if(oStyle.image){$container.find('[data-event]').parent().removeClass("active");$container.find('a[data-event="padding"][data-value="small"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-small"));$container.find('a[data-event="padding"][data-value="medium"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-medium"));$container.find('a[data-event="padding"][data-value="large"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-large"));$container.find('a[data-event="padding"][data-value="xl"]').parent().toggleClass("active",$(oStyle.image).hasClass("padding-xl"));$container.find('a[data-event="padding"][data-value=""]').parent().toggleClass("active",!$container.find('.active a[data-event="padding"]').length);if(dom.isImgFont(oStyle.image)){$container.find('.btn-group:not(.only_fa):has(button[data-event="resize"],button[data-value="img-thumbnail"])').addClass("hidden");$container.find('.only_fa').removeClass("hidden");$container.find('button[data-event="resizefa"][data-value="2"]').toggleClass("active",$(oStyle.image).hasClass("fa-2x"));$container.find('button[data-event="resizefa"][data-value="3"]').toggleClass("active",$(oStyle.image).hasClass("fa-3x"));$container.find('button[data-event="resizefa"][data-value="4"]').toggleClass("active",$(oStyle.image).hasClass("fa-4x"));$container.find('button[data-event="resizefa"][data-value="5"]').toggleClass("active",$(oStyle.image).hasClass("fa-5x"));$container.find('button[data-event="resizefa"][data-value="1"]').toggleClass("active",!$container.find('.active[data-event="resizefa"]').length);$container.find('button[data-event="imageShape"][data-value="fa-spin"]').toggleClass("active",$(oStyle.image).hasClass("fa-spin"));$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));}else{$container.find('.hidden:not(.only_fa)').removeClass("hidden");$container.find('.only_fa').addClass("hidden");var width=($(oStyle.image).attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+%)/);if(width){width=width[2];}
$container.find('button[data-event="resize"][data-value="auto"]').toggleClass("active",width!=="100%"&&width!=="50%"&&width!=="25%");$container.find('button[data-event="resize"][data-value="1"]').toggleClass("active",width==="100%");$container.find('button[data-event="resize"][data-value="0.5"]').toggleClass("active",width==="50%");$container.find('button[data-event="resize"][data-value="0.25"]').toggleClass("active",width==="25%");$container.find('button[data-event="imageShape"][data-value="shadow"]').toggleClass("active",$(oStyle.image).hasClass("shadow"));if(!$(oStyle.image).is("img")){$container.find('.btn-group:has(button[data-event="imageShape"])').addClass("hidden");}
$container.find('.note-color').addClass("hidden");}
$container.find('button[data-event="floatMe"][data-value="left"]').toggleClass("active",$(oStyle.image).hasClass("pull-left"));$container.find('button[data-event="floatMe"][data-value="center"]').toggleClass("active",$(oStyle.image).hasClass("center-block"));$container.find('button[data-event="floatMe"][data-value="right"]').toggleClass("active",$(oStyle.image).hasClass("pull-right"));$(oStyle.image).trigger('attributes_change');}};var fn_popover_update=eventHandler.modules.popover.update;eventHandler.modules.popover.update=function($popover,oStyle,isAirMode){var $imagePopover=$popover.find('.note-image-popover');var $linkPopover=$popover.find('.note-link-popover');var $airPopover=$popover.find('.note-air-popover');fn_popover_update.call(this,$popover,oStyle,isAirMode);if(oStyle.image){if(oStyle.image.parentNode.className.match(/(^|\s)media_iframe_video(\s|$)/i)){oStyle.image=oStyle.image.parentNode;}
var alt=$(oStyle.image).attr("alt");$imagePopover.find('.o_image_alt').text((alt||"").replace(/&quot;/g,'"')).parent().toggle(oStyle.image.tagName==="IMG");$imagePopover.show();var target_node=oStyle.image;if(!oStyle.image.className.match(/(^|\s)media_iframe_video(\s|$)/i)){target_node=dom.firstChild(target_node);}
range.createFromNode(target_node).select();eventHandler.modules.editor.saveRange(dom.makeLayoutInfo(target_node).editable());}else{$(".note-control-selection").hide();}
if(oStyle.image||(oStyle.range&&(!oStyle.range.isCollapsed()||(oStyle.range.sc.tagName&&!dom.isAnchor(oStyle.range.sc))))||(oStyle.image&&!$(oStyle.image).closest('a').length)){$linkPopover.hide();oStyle.anchor=false;}
if(oStyle.image||oStyle.anchor||(oStyle.range&&!$(oStyle.range.sc).closest('.note-editable').length)){$airPopover.hide();}else{$airPopover.show();}};var fn_handle_update=eventHandler.modules.handle.update;eventHandler.modules.handle.update=function($handle,oStyle,isAirMode){fn_handle_update.call(this,$handle,oStyle,isAirMode);if(oStyle.image){$handle.find('.note-control-selection').hide();}};function getImgTarget($editable){var $handle=$editable?dom.makeLayoutInfo($editable).handle():undefined;return $(".note-control-selection",$handle).data('target');}
eventHandler.modules.editor.padding=function($editable,sValue){var $target=$(getImgTarget($editable));var paddings="small medium large xl".split(/\s+/);$editable.data('NoteHistory').recordUndo();if(sValue.length){paddings.splice(paddings.indexOf(sValue),1);$target.toggleClass('padding-'+sValue);}
$target.removeClass("padding-"+paddings.join(" padding-"));};eventHandler.modules.editor.resize=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();var width=($target.attr('style')||'').match(/(^|;|\s)width:\s*([0-9]+)%/);if(width){width=width[2]/100;}
$target.css('width',(width!==sValue&&sValue!=="auto")?(sValue*100)+'%':'');};eventHandler.modules.editor.resizefa=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.attr('class',$target.attr('class').replace(/\s*fa-[0-9]+x/g,''));if(+sValue>1){$target.addClass('fa-'+sValue+'x');}};eventHandler.modules.editor.floatMe=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();switch(sValue){case'center':$target.toggleClass('center-block').removeClass('pull-right pull-left');break;case'left':$target.toggleClass('pull-left').removeClass('pull-right center-block');break;case'right':$target.toggleClass('pull-right').removeClass('pull-left center-block');break;}};eventHandler.modules.editor.imageShape=function($editable,sValue){var $target=$(getImgTarget($editable));$editable.data('NoteHistory').recordUndo();$target.toggleClass(sValue);};eventHandler.modules.linkDialog.showLinkDialog=function($editable,$dialog,linkInfo){$editable.data('range').select();$editable.data('NoteHistory').recordUndo();var editor=new widgets.LinkDialog(null,{},$editable,linkInfo).open();var def=new $.Deferred();editor.on("save",this,function(linkInfo){linkInfo.range.select();$editable.data('range',linkInfo.range);def.resolve(linkInfo);$editable.trigger('keyup');$('.note-popover .note-link-popover').show();});editor.on("cancel",this,function(){def.reject();});return def;};eventHandler.modules.imageDialog.showImageDialog=function($editable){var r=$editable.data('range');if(r.sc.tagName&&r.sc.childNodes.length){r.sc=r.sc.childNodes[r.so];}
new widgets.MediaDialog(null,{},$editable,$(r.sc).parents().addBack().filter(function(i,el){return dom.isImg(el);})[0]).open();return new $.Deferred().reject();};$.summernote.pluginEvents.alt=function(event,editor,layoutInfo,sorted){var $editable=layoutInfo.editable();var $selection=layoutInfo.handle().find('.note-control-selection');var media=$selection.data('target');new widgets.alt(null,{},$editable,media).open();};var fn_is_void=dom.isVoid||function(){};dom.isVoid=function(node){return fn_is_void(node)||dom.isImgFont(node)||(node&&node.className&&node.className.match(/(^|\s)media_iframe_video(\s|$)/i));};var fn_is_img=dom.isImg||function(){};dom.isImg=function(node){return fn_is_img(node)||dom.isImgFont(node)||(node&&(node.nodeName==="IMG"||(node.className&&node.className.match(/(^|\s)(media_iframe_video|o_image)(\s|$)/i))));};var fn_is_forbidden_node=dom.isForbiddenNode||function(){};dom.isForbiddenNode=function(node){if(node.tagName==="BR"){return false;}
return fn_is_forbidden_node(node)||$(node).is(".media_iframe_video");};var fn_is_img_font=dom.isImgFont||function(){};dom.isImgFont=function(node){if(fn_is_img_font(node))return true;var nodeName=node&&node.nodeName.toUpperCase();var className=(node&&node.className||"");if(node&&(nodeName==="SPAN"||nodeName==="I")&&className.length){var classNames=className.split(/\s+/);for(var k=0;k<widgets.fontIcons.length;k++){if(_.intersection(widgets.fontIcons[k].alias,classNames).length){return true;}}}
return false;};var fn_is_font=dom.isFont;dom.isFont=function(node){return fn_is_font(node)||dom.isImgFont(node);};var fn_visible=$.summernote.pluginEvents.visible;$.summernote.pluginEvents.visible=function(event,editor,layoutInfo){var res=fn_visible.apply(this,arguments);var rng=range.create();if(!rng)return res;var $node=$(dom.node(rng.sc));if(($node.is('[data-oe-type="html"]')||$node.is('[data-oe-field="arch"]'))&&$node.hasClass("o_editable")&&!$node[0].children.length&&"h1 h2 h3 h4 h5 h6 p b bold i u code sup strong small pre th td label".toUpperCase().indexOf($node[0].nodeName)===-1){var p=$('<p><br/></p>')[0];$node.append(p);range.createFromNode(p.firstChild).select();}
return res;};function prettify_html(html){html=html.trim();var result='',level=0,get_space=function(level){var i=level,space='';while(i--)space+='  ';return space;},reg=/^<\/?(a|span|font|u|em|i|strong|b)(\s|>)/i,inline_level=Infinity,tokens=_.compact(_.flatten(_.map(html.split(/</),function(value){value=value.replace(/\s+/g,' ').split(/>/);value[0]=/\S/.test(value[0])?'<'+value[0]+'>':'';return value;})));for(var i=0,l=tokens.length;i<l;i++){var token=tokens[i];var inline_tag=reg.test(token);var inline=inline_tag||inline_level<=level;if(token[0]==='<'&&token[1]==='/'){if(inline_tag&&inline_level===level){inline_level=Infinity;}
level--;}
if(!inline&&!/\S/.test(token)){continue;}
if(!inline||(token[1]!=='/'&&inline_level>level)){result+=get_space(level);}
if(token[0]==='<'&&token[1]!=='/'){level++;if(inline_tag&&inline_level>level){inline_level=level;}}
if(token.match(/^<(img|hr|br)/)){level--;}
if(!inline){token=token.trim();}
result+=token.replace(/\s+/,' ');if(inline_level>level){result+='\n';}}
return result;}
$.summernote.pluginEvents.codeview=function(event,editor,layoutInfo,enable){if(layoutInfo===undefined){return;}
if(layoutInfo.toolbar){var is_activated=$.summernote.eventHandler.modules.codeview.isActivated(layoutInfo);if(is_activated===enable){return;}
return eventHandler.modules.codeview.toggle(layoutInfo);}else{var $editor=layoutInfo.editor();var $textarea=$editor.prev('textarea');if($textarea.is('textarea')===enable){return;}
if(!$textarea.length){var html=prettify_html($editor.prop("innerHTML"));$editor.parent().css({'position':'absolute','top':0,'bottom':0,'left':0,'right':0});$textarea=$('<textarea/>').css({'margin':'0 -4px','padding':'0 4px','border':0,'top':'51px','left':'620px','width':'100%','font-family':'sans-serif','font-size':'13px','height':'98%','white-space':'pre','word-wrap':'normal'}).val(html).data('init',html);$editor.before($textarea);$editor.hide();}else{$editor.prop('innerHTML',$textarea.val().replace(/\s*\n\s*/g,'')).trigger('content_changed');$textarea.remove();$editor.show();}}};var initial_data={};function reRangeSelectKey(event){initial_data.range=null;if(event.shiftKey&&event.keyCode>=37&&event.keyCode<=40&&!$(event.target).is("input, textarea, select")){var r=range.create();if(r){var rng=r.reRange(event.keyCode<=38);if(r!==rng){rng.select();}}}}
function reRangeSelect(event,dx,dy){var r=range.create();if(!r||r.isCollapsed())return;var data=r.reRange(dy<0||(dy===0&&dx<0));if(data.sc!==r.sc||data.so!==r.so||data.ec!==r.ec||data.eo!==r.eo){setTimeout(function(){data.select();$(data.sc.parentNode).closest('.note-popover');},0);}
$(data.sc).closest('.o_editable').data('range',r);return r;}
function summernote_mouseup(event){if($(event.target).closest("#web_editor-top-navbar, .note-popover").length){return;}
if(initial_data.event){var dx=event.clientX-(event.shiftKey&&initial_data.rect?initial_data.rect.left:initial_data.event.clientX);var dy=event.clientY-(event.shiftKey&&initial_data.rect?initial_data.rect.top:initial_data.event.clientY);if(10<Math.pow(dx,2)+Math.pow(dy,2)){reRangeSelect(event,dx,dy);}}
if(!$(event.target).closest(".o_editable").length){return;}
if(!initial_data.range||!event.shiftKey){setTimeout(function(){initial_data.range=range.create();},0);}}
var remember_selection;function summernote_mousedown(event){rte.history.splitNext();var $editable=$(event.target).closest(".o_editable, .note-editor");var r;if(document.documentMode){summernote_ie_fix(event,function(node){return node.tagName==="DIV"||node.tagName==="IMG"||(node.dataset&&node.dataset.oeModel);});}else if(last_div&&event.target!==last_div){if(last_div.tagName==="A"){summernote_ie_fix(event,function(node){return node.dataset&&node.dataset.oeModel;});}else if($editable.length){if(summernote_ie_fix(event,function(node){return node.tagName==="A";})){r=range.create();r.select();}}}
try{r=range.create();}catch(e){return;}
var editables=$(".o_editable[contenteditable], .note-editable[contenteditable]");var r_editable=editables.has((r||{}).sc).addBack(editables.filter((r||{}).sc));if(!r_editable.closest('.note-editor').is($editable)&&!r_editable.filter('.o_editable').is(editables)){var saved_editable=editables.has((remember_selection||{}).sc);if($editable.length&&!saved_editable.closest('.o_editable, .note-editor').is($editable)){remember_selection=range.create(dom.firstChild($editable[0]),0);}else if(!saved_editable.length){remember_selection=undefined;}
if(remember_selection){try{remember_selection.select();}catch(e){console.warn(e);}}}else if(r_editable.length){remember_selection=r;}
initial_data.event=event;if(event.shiftKey&&$editable.length){if(initial_data.range){initial_data.range.select();}
var rect=r&&r.getClientRects();initial_data.rect=rect&&rect.length?rect[0]:{top:0,left:0};}}
var last_div;var last_div_change;var last_editable;function summernote_ie_fix(event,pred){var editable;var div;var node=event.target;while(node.parentNode){if(!div&&pred(node)){div=node;}
if(last_div!==node&&(node.getAttribute('contentEditable')==='false'||node.className&&(node.className.indexOf('o_not_editable')!==-1))){break;}
if(node.className&&node.className.indexOf('o_editable')!==-1){if(!div){div=node;}
editable=node;break;}
node=node.parentNode;}
if(!editable){$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");$(last_editable).attr("contentEditable","true").prop("contentEditable","true");last_div_change=null;last_editable=null;return;}
if(div===last_div){return;}
last_div=div;$(last_div_change).removeAttr("contentEditable").removeProp("contentEditable");if(last_editable!==editable){if($(editable).is("[contentEditable='true']")){$(editable).removeAttr("contentEditable").removeProp("contentEditable");last_editable=editable;}else{last_editable=null;}}
if(!$(div).attr("contentEditable")&&!$(div).is("[data-oe-type='many2one'], [data-oe-type='contact']")){$(div).attr("contentEditable","true").prop("contentEditable","true");last_div_change=div;}else{last_div_change=null;}
return editable!==div?div:null;}
var fn_attach=eventHandler.attach;eventHandler.attach=function(oLayoutInfo,options){fn_attach.call(this,oLayoutInfo,options);oLayoutInfo.editor().on('dragstart','img',function(e){e.preventDefault();});$(document).on('mousedown',summernote_mousedown).on('mouseup',summernote_mouseup);oLayoutInfo.editor().off('click').on('click',function(e){e.preventDefault();});create_dblclick_feature("img, .media_iframe_video, i.fa, span.fa, a.o_image",function(){eventHandler.modules.imageDialog.show(oLayoutInfo);});create_dblclick_feature("a[href], a.btn, button.btn",function(){eventHandler.modules.linkDialog.show(oLayoutInfo);});if(oLayoutInfo.editor().is('[data-oe-model][data-oe-type="image"]')){oLayoutInfo.editor().on('click','img',function(event){$(event.target).trigger("dblclick");});}
oLayoutInfo.editable().on('mousedown',function(e){if(dom.isImg(e.target)){range.createFromNode(e.target).select();}});$(document).on("keyup",reRangeSelectKey);var clone_data=false;var $node=oLayoutInfo.editor();if($node.data('oe-model')||$node.data('oe-translation-id')){$node.on('content_changed',function(){var $nodes=$('[data-oe-model], [data-oe-translation-id]').filter(function(){return this!==$node[0];});if($node.data('oe-model')){$nodes=$nodes.filter('[data-oe-model="'+$node.data('oe-model')+'"]').filter('[data-oe-id="'+$node.data('oe-id')+'"]').filter('[data-oe-field="'+$node.data('oe-field')+'"]');}
if($node.data('oe-translation-id'))$nodes=$nodes.filter('[data-oe-translation-id="'+$node.data('oe-translation-id')+'"]');if($node.data('oe-type'))$nodes=$nodes.filter('[data-oe-type="'+$node.data('oe-type')+'"]');if($node.data('oe-expression'))$nodes=$nodes.filter('[data-oe-expression="'+$node.data('oe-expression')+'"]');if($node.data('oe-xpath'))$nodes=$nodes.filter('[data-oe-xpath="'+$node.data('oe-xpath')+'"]');if($node.data('oe-contact-options'))$nodes=$nodes.filter('[data-oe-contact-options="'+$node.data('oe-contact-options')+'"]');var nodes=$node.get();if($node.data('oe-type')==="many2one"){$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!==$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-many2one-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-many2one-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-type="many2one"]'));$nodes=$nodes.add($('[data-oe-model]').filter(function(){return this!==$node[0]&&nodes.indexOf(this)===-1;}).filter('[data-oe-model="'+$node.data('oe-many2one-model')+'"]').filter('[data-oe-id="'+$node.data('oe-many2one-id')+'"]').filter('[data-oe-field="name"]'));}
if(!clone_data){clone_data=true;$nodes.html(this.innerHTML);clone_data=false;}});}
var custom_toolbar=oLayoutInfo.toolbar?oLayoutInfo.toolbar():undefined;var $toolbar=$(oLayoutInfo.popover()).add(custom_toolbar);$('button[data-event="undo"], button[data-event="redo"]',$toolbar).attr('disabled',true);$(oLayoutInfo.editor()).add(oLayoutInfo.handle()).add(oLayoutInfo.popover()).add(custom_toolbar).on('click content_changed',function(){$('button[data-event="undo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasUndo());$('button[data-event="redo"]',$toolbar).attr('disabled',!oLayoutInfo.editable().data('NoteHistory').hasRedo());});function create_dblclick_feature(selector,callback){var show_tooltip=true;oLayoutInfo.editor().on("dblclick",selector,function(e){if($(e.target).closest(".note-toolbar").length)return;show_tooltip=false;callback();});oLayoutInfo.editor().on("click",selector,function(e){var $target=$(e.target);if($target.closest(".note-toolbar").length)return;show_tooltip=true;setTimeout(function(){if(!show_tooltip)return;$target.tooltip({title:_t('Double-click to edit'),trigger:'manuel',container:'body'}).tooltip('show');setTimeout(function(){$target.tooltip('destroy');},800);},400);});}};var fn_detach=eventHandler.detach;eventHandler.detach=function(oLayoutInfo,options){fn_detach.call(this,oLayoutInfo,options);oLayoutInfo.editable().off('mousedown');oLayoutInfo.editor().off("dragstart");oLayoutInfo.editor().off('click');$(document).off('mousedown',summernote_mousedown);$(document).off('mouseup',summernote_mouseup);oLayoutInfo.editor().off("dblclick");$(document).off("keyup",reRangeSelectKey);};$.summernote.lang.odoo={font:{bold:_t('Bold'),italic:_t('Italic'),underline:_t('Underline'),strikethrough:_t('Strikethrough'),subscript:_t('Subscript'),superscript:_t('Superscript'),clear:_t('Remove Font Style'),height:_t('Line Height'),name:_t('Font Family'),size:_t('Font Size')},image:{image:_t('File / Image'),insert:_t('Insert Image'),resizeFull:_t('Resize Full'),resizeHalf:_t('Resize Half'),resizeQuarter:_t('Resize Quarter'),floatLeft:_t('Float Left'),floatRight:_t('Float Right'),floatNone:_t('Float None'),dragImageHere:_t('Drag an image here'),selectFromFiles:_t('Select from files'),url:_t('Image URL'),remove:_t('Remove Image')},link:{link:_t('Link'),insert:_t('Insert Link'),unlink:_t('Unlink'),edit:_t('Edit'),textToDisplay:_t('Text to display'),url:_t('To what URL should this link go?'),openInNewWindow:_t('Open in new window')},video:{video:_t('Video'),videoLink:_t('Video Link'),insert:_t('Insert Video'),url:_t('Video URL?'),providers:_t('(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)')},table:{table:_t('Table')},hr:{insert:_t('Insert Horizontal Rule')},style:{style:_t('Style'),normal:_t('Normal'),blockquote:_t('Quote'),pre:_t('Code'),h1:_t('Header 1'),h2:_t('Header 2'),h3:_t('Header 3'),h4:_t('Header 4'),h5:_t('Header 5'),h6:_t('Header 6')},lists:{unordered:_t('Unordered list'),ordered:_t('Ordered list')},options:{help:_t('Help'),fullscreen:_t('Full Screen'),codeview:_t('Code View')},paragraph:{paragraph:_t('Paragraph'),outdent:_t('Outdent'),indent:_t('Indent'),left:_t('Align left'),center:_t('Align center'),right:_t('Align right'),justify:_t('Justify full')},color:{recent:_t('Recent Color'),more:_t('More Color'),background:_t('Background Color'),foreground:_t('Font Color'),transparent:_t('Transparent'),setTransparent:_t('Set transparent'),reset:_t('Reset'),resetToDefault:_t('Reset to default')},shortcut:{shortcuts:_t('Keyboard shortcuts'),close:_t('Close'),textFormatting:_t('Text formatting'),action:_t('Action'),paragraphFormatting:_t('Paragraph formatting'),documentStyle:_t('Document Style')},history:{undo:_t('Undo'),redo:_t('Redo')}};});;

/* /web_editor/static/src/js/widgets.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.widget',function(require){'use strict';var core=require('web.core');var ajax=require('web.ajax');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var utils=require('web.utils');var base=require('web_editor.base');var rte=require('web_editor.rte');var QWeb=core.qweb;var range=$.summernote.core.range;var dom=$.summernote.core.dom;var _t=core._t;Dialog=Dialog.extend({init:function(parent,options){options=options||{};this._super(parent,_.extend({},{buttons:[{text:options.save_text||_t("Save"),classes:"btn-primary o_save_button",click:this.save},{text:_t("Discard"),close:true}]},options));this.destroyAction="cancel";var self=this;this.opened().then(function(){self.$('input:first').focus();});this.on("closed",this,function(){this.trigger(this.destroyAction,this.final_data||null);});},save:function(){this.destroyAction="save";this.close();},});var alt=Dialog.extend({template:'web_editor.dialog.alt',init:function(parent,options,$editable,media){this._super(parent,_.extend({},{title:_t("Change media description and tooltip")},options));this.$editable=$editable;this.media=media;this.alt=($(this.media).attr('alt')||"").replace(/&quot;/g,'"');this.title=($(this.media).attr('title')||"").replace(/&quot;/g,'"');},save:function(){range.createFromNode(this.media).select();this.$editable.data('NoteHistory').recordUndo();var alt=this.$('#alt').val();var title=this.$('#title').val();$(this.media).attr('alt',alt?alt.replace(/"/g,"&quot;"):null).attr('title',title?title.replace(/"/g,"&quot;"):null);_.defer((function(){click_event(this.media,"mouseup");}).bind(this));return this._super.apply(this,arguments);},});var click_event=function(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);};var MediaDialog=Dialog.extend({template:'web_editor.dialog.media',events:_.extend({},Dialog.prototype.events,{'input input#icon-search':'search',}),init:function(parent,options,$editable,media){this._super(parent,_.extend({},{title:_t("Select a Media"),},options));if($editable){this.$editable=$editable;this.rte=this.$editable.rte||this.$editable.data('rte');}
this.options=options||{};this.old_media=media;this.media=media;this.isNewMedia=!media;this.range=range.create();this.$modal.addClass('note-image-dialog');this.$modal.find('.modal-dialog').addClass('o_select_media_dialog');},start:function(){var self=this;this.only_images=this.options.only_images||this.options.select_images||(this.media&&$(this.media).parent().data("oe-field")==="image");if(this.only_images){this.$('[href="#editor-media-document"], [href="#editor-media-video"], [href="#editor-media-icon"]').addClass('hidden');}
this.opened((function(){if(this.media){if(this.media.nodeName==="IMG"){this.$('[href="#editor-media-image"]').tab('show');}else if($(this.media).is('a.o_image')){this.$('[href="#editor-media-document"]').tab('show');}else if(this.media.className.match(/(^|\s)media_iframe_video($|\s)/)){this.$('[href="#editor-media-video"]').tab('show');}else if(this.media.parentNode.className.match(/(^|\s)media_iframe_video($|\s)/)){this.media=this.media.parentNode;this.$('[href="#editor-media-video"]').tab('show');}else if(this.media.className.match(/(^|\s)fa($|\s)/)){this.$('[href="#editor-media-icon"]').tab('show');}}}).bind(this));this.imageDialog=new ImageDialog(this,this.media,this.options);this.imageDialog.appendTo(this.$("#editor-media-image"));this.documentDialog=new ImageDialog(this,this.media,_.extend({'document':true},this.options));this.documentDialog.appendTo(this.$("#editor-media-document"));if(!this.only_images){this.iconDialog=new fontIconsDialog(this,this.media,this.options);this.iconDialog.appendTo(this.$("#editor-media-icon"));this.videoDialog=new VideoDialog(this,this.media,this.options);this.videoDialog.appendTo(this.$("#editor-media-video"));}
this.active=this.imageDialog;this.$('a[data-toggle="tab"]').on('shown.bs.tab',function(event){if($(event.target).is('[href="#editor-media-image"]')){self.active=self.imageDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");}else if($(event.target).is('[href="#editor-media-document"]')){self.active=self.documentDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");}else if($(event.target).is('[href="#editor-media-icon"]')){self.active=self.iconDialog;self.$('li.search, li.previous, li.next').removeClass("hidden");self.$('.nav-tabs li.previous, .nav-tabs li.next').addClass("hidden");}else if($(event.target).is('[href="#editor-media-video"]')){self.active=self.videoDialog;self.$('.nav-tabs li.search').addClass("hidden");}});return this._super.apply(this,arguments);},save:function(){if(this.options.select_images){this.final_data=this.active.save();this._super.apply(this,arguments);return;}
if(this.rte){this.range.select();this.rte.historyRecordUndo(this.media);}
var self=this;if(self.media){this.media.innerHTML="";if(this.active!==this.imageDialog&&this.active!==this.documentDialog){this.imageDialog.clear();}
if(this.iconDialog&&this.active!==this.iconDialog){this.iconDialog.clear();}
if(this.videoDialog&&this.active!==this.videoDialog){this.videoDialog.clear();}}else{this.media=document.createElement("img");this.range.insertNode(this.media,true);this.active.media=this.media;}
this.active.save();if(this.active.add_class){$(this.active.media).addClass(this.active.add_class);}
var media=this.active.media;this.final_data=[media,self.old_media];$(document.body).trigger("media-saved",this.final_data);_.defer(function(){if(!media.parentNode)return;range.createFromNode(media).select();click_event(media,"mousedown");click_event(media,"mouseup");});this._super.apply(this,arguments);},searchTimer:null,search:function(){var self=this;var needle=this.$("input#icon-search").val();clearTimeout(this.searchTimer);this.searchTimer=setTimeout(function(){self.active.search(needle||"");},250);}});var ImageDialog=Widget.extend({template:'web_editor.dialog.image',IMAGES_PER_ROW:6,IMAGES_ROWS:2,events:_.extend({},Dialog.prototype.events,{'change .url-source':function(e){this.changed($(e.target));},'click button.filepicker':function(){var filepicker=this.$('input[type=file]');if(!_.isEmpty(filepicker)){filepicker[0].click();}},'click .js_disable_optimization':function(){this.$('input[name="disable_optimization"]').val('1');var filepicker=this.$('button.filepicker');if(!_.isEmpty(filepicker)){filepicker[0].click();}},'change input[type=file]':'file_selection','submit form':'form_submit','change input.url':"change_input",'keyup input.url':"change_input",'click .existing-attachments [data-src]':'select_existing','dblclick .existing-attachments [data-src]':function(){this.getParent().save();},'click .o_existing_attachment_remove':'try_remove','keydown.dismiss.bs.modal':function(){},}),init:function(parent,media,options){this._super.apply(this,arguments);this.options=options||{};this.accept=this.options.accept||this.options.document?"*/*":"image/*";this.domain=this.options.domain||['|',['mimetype','=',false],['mimetype',this.options.document?'not in':'in',['image/gif','image/jpe','image/jpeg','image/jpg','image/gif','image/png']]];this.parent=parent;this.old_media=media;this.media=media;this.images=[];this.page=0;},start:function(){this.$preview=this.$('.preview-container').detach();var self=this;var res=this._super.apply(this,arguments);var o={url:null,alt:null};if($(this.media).is("img")){o.url=this.media.getAttribute('src');}else if($(this.media).is("a.o_image")){o.url=this.media.getAttribute('href').replace(/[?].*/,'');o.id=+o.url.match(/\/web\/content\/([0-9]*)/,'')[1];}
this.parent.$(".pager > li").click(function(e){if(!self.$el.is(':visible')){return;}
e.preventDefault();var $target=$(e.currentTarget);if($target.hasClass('disabled')){return;}
self.page+=$target.hasClass('previous')?-1:1;self.display_attachments();});this.fetch_existing().then(function(){if(o.url){self.set_image(_.find(self.records,function(record){return record.url===o.url;})||o);}});return res;},push:function(attachment){if(this.options.select_images){var img=_.select(this.images,function(v){return v.id===attachment.id;});if(img.length){this.images.splice(this.images.indexOf(img[0]),1);}}else{this.images=[];}
this.images.push(attachment);},save:function(){if(this.options.select_images){return this.images;}
var img=this.images[0];if(!img){return this.media;}
var media;if(!img.is_document){if(this.media.tagName!=="IMG"||!this.old_media){this.add_class="pull-left";this.style={"width":"100%"};}
if(this.media.tagName!=="IMG"){media=document.createElement('img');$(this.media).replaceWith(media);this.media=media;}
this.media.setAttribute('src',img.src);}else{if(this.media.tagName!=="A"){$('.note-control-selection').hide();media=document.createElement('a');$(this.media).replaceWith(media);this.media=media;}
this.media.setAttribute('href','/web/content/'+img.id+'?unique='+img.checksum+'&download=true');$(this.media).addClass('o_image').attr('title',img.name).attr('data-mimetype',img.mimetype);}
$(this.media).attr('alt',img.alt);var style=this.style;if(style){$(this.media).css(style);}
return this.media;},clear:function(){this.media.className=this.media.className.replace(/(^|\s+)((img(\s|$)|img-(?!circle|rounded|thumbnail))[^\s]*)/g,' ');},change_input:function(e){var $input=$(e.target);var $button=$input.parent().find("button");var emptyValue=($input.val()==="");$button.toggleClass("btn-default",emptyValue).toggleClass("btn-primary",!emptyValue);},search:function(needle){var self=this;this.fetch_existing(needle).then(function(){self.selected_existing();});},set_image:function(attachment){this.push(attachment);this.$('input.url').val('');this.search();},form_submit:function(event){var self=this;var $form=this.$('form[action="/web_editor/attachment/add"]');if(!$form.find('input[name="upload"]').val().length){if(this.selected_existing().size()){event.preventDefault();return false;}}
$form.find('.well > div').hide().last().after('<span class="fa fa-spin fa-3x fa-refresh"/>');var callback=_.uniqueId('func_');this.$('input[name=func]').val(callback);window[callback]=function(attachments,error){delete window[callback];$form.find('.well > span').remove();$form.find('.well > div').show();_.each(attachments,function(record){record.src=record.url||_.str.sprintf('/web/image/%s/%s',record.id,encodeURI(record.name));record.is_document=!(/gif|jpe|jpg|png/.test(record.mimetype));});if(error||!attachments.length){self.file_selected(null,error||!attachments.length);}
self.images=attachments;for(var i=0;i<attachments.length;i++){self.file_selected(attachments[i],error);}};},file_selection:function(){var $form=this.$('form');this.$el.addClass('nosave');$form.removeClass('has-error').find('.help-block').empty();this.$('button.filepicker').removeClass('btn-danger btn-success');$form.submit();},file_selected:function(attachment,error){var $button=this.$('button.filepicker');if(!error){$button.addClass('btn-success');this.set_image(attachment);}else{this.$('form').addClass('has-error').find('.help-block').text(error);$button.addClass('btn-danger');}
if(!this.options.select_images){this.parent.save();}},fetch_existing:function(needle){var domain=[['res_model','=','ir.ui.view']].concat(this.domain);if(needle&&needle.length){domain.push('|',['datas_fname','ilike',needle],['name','ilike',needle]);}
return ajax.jsonRpc('/web/dataset/call_kw','call',{model:'ir.attachment',method:'search_read',args:[],kwargs:{domain:domain,fields:['name','mimetype','checksum','url','type'],order:'id desc',context:base.get_context()}}).then(this.proxy('fetched_existing'));},fetched_existing:function(records){this.records=_.uniq(_.filter(records,function(r){return(r.type==="binary"||r.url&&r.url.length>0);}),function(r){return(r.url||r.id);});_.each(this.records,function(record){record.src=record.url||_.str.sprintf('/web/image/%s/%s',record.id,encodeURI(record.name));record.is_document=!(/gif|jpe|jpg|png/.test(record.mimetype));});this.display_attachments();},display_attachments:function(){var self=this;var per_screen=this.IMAGES_PER_ROW*this.IMAGES_ROWS;var from=this.page*per_screen;var records=this.records;var rows=_(records).chain().slice(from,from+per_screen).groupBy(function(_,index){return Math.floor(index/self.IMAGES_PER_ROW);}).values().value();this.$('.help-block').empty();this.$('.existing-attachments').replaceWith(QWeb.render('web_editor.dialog.image.existing.content',{rows:rows}));this.parent.$('.pager').find('li.previous').toggleClass('disabled',(from===0)).end().find('li.next').toggleClass('disabled',(from+per_screen>=records.length));this.$el.find('.o_image').each(function(){var $div=$(this);if(/gif|jpe|jpg|png/.test($div.data('mimetype'))){var $img=$('<img/>').addClass('img img-responsive').attr('src',$div.data('url')||$div.data('src'));$div.addClass('o_webimage').append($img);}});this.selected_existing();},select_existing:function(e){var $img=$(e.currentTarget);var attachment=_.find(this.records,function(record){return record.id===$img.data('id');});this.push(attachment);this.selected_existing();},selected_existing:function(){var self=this;this.$('.o_existing_attachment_cell.o_selected').removeClass("o_selected");var $select=this.$('.o_existing_attachment_cell [data-src]').filter(function(){var $img=$(this);return!!_.find(self.images,function(v){return(v.url===$img.data("src")||($img.data("url")&&v.url===$img.data("url"))||v.id===$img.data("id"));});});$select.closest('.o_existing_attachment_cell').addClass("o_selected");return $select;},try_remove:function(e){var $help_block=this.$('.help-block').empty();var self=this;var $a=$(e.target);var id=parseInt($a.data('id'),10);var attachment=_.findWhere(this.records,{id:id});var $both=$a.parent().children();$both.css({borderWidth:"5px",borderColor:"#f00"});return ajax.jsonRpc('/web_editor/attachment/remove','call',{'ids':[id]}).then(function(prevented){if(_.isEmpty(prevented)){self.records=_.without(self.records,attachment);self.display_attachments();return;}
$both.css({borderWidth:"",borderColor:""});$help_block.replaceWith(QWeb.render('web_editor.dialog.image.existing.error',{views:prevented[id]}));});},});var fontIcons=[{'base':'fa','parser':/(?=^|\s)(\.fa-[0-9a-z_-]+::?before)/i}];var cacheCssSelectors={};var getCssSelectors=function(filter){var css=[];if(cacheCssSelectors[filter]){return cacheCssSelectors[filter];}
var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(rules){for(var r=0;r<rules.length;r++){var selectorText=rules[r].selectorText;if(selectorText){selectorText=selectorText.split(/\s*,\s*/);var data=null;for(var s=0;s<selectorText.length;s++){var match=selectorText[s].match(filter);if(match){var clean=match[1].slice(1).replace(/::?before$/,'');if(!data){data=[match[1],rules[r].cssText.replace(/(^.*\{\s*)|(\s*\}\s*$)/g,''),clean,[clean]];}else{data[0]+=(", "+match[1]);data[3].push(clean);}}}
if(data){css.push(data);}}}}}
return cacheCssSelectors[filter]=css;};var computeFonts=_.once(function(){_.each(fontIcons,function(data){data.cssData=getCssSelectors(data.parser);data.alias=[];data.icons=_.map(data.cssData,function(css){data.alias.push.apply(data.alias,css[3]);return css[2];});});});rte.Class.include({init:function(){this._super.apply(this,arguments);computeFonts();},onEnableEditableArea:function($editable){if($editable.data('oe-type')==="monetary"){$editable.attr('contenteditable',false);$editable.find('.oe_currency_value').attr('contenteditable',true);}
if($editable.is('[data-oe-model]')&&!$editable.is('[data-oe-model="ir.ui.view"]')&&!$editable.is('[data-oe-type="html"]')){$editable.data('layoutInfo').popover().find('.btn-group:not(.note-history)').remove();}},});var fontIconsDialog=Widget.extend({template:'web_editor.dialog.font-icons',events:_.extend({},Dialog.prototype.events,{'click .font-icons-icon':function(e){e.preventDefault();e.stopPropagation();this.$('#fa-icon').val(e.target.getAttribute('data-id'));this.$(".font-icons-icon").removeClass("o_selected");$(e.target).addClass("o_selected");},'dblclick .font-icons-icon':function(){this.getParent().save();},'keydown.dismiss.bs.modal':function(){},}),init:function(parent,media){this._super.apply(this,arguments);this.parent=parent;this.media=media;computeFonts();},start:function(){return this._super.apply(this,arguments).then(this.proxy('load_data'));},renderElement:function(){this.iconsParser=fontIcons;this.icons=_.flatten(_.map(fontIcons,function(data){return data.icons;}));this.alias=_.flatten(_.map(fontIcons,function(data){return data.alias;}));this._super.apply(this,arguments);},search:function(needle){var iconsParser=this.iconsParser;if(needle){iconsParser=[];_.filter(this.iconsParser,function(data){var cssData=_.filter(data.cssData,function(cssData){return _.find(cssData[3],function(alias){return alias.indexOf(needle)!==-1;});});if(cssData.length){iconsParser.push({base:data.base,cssData:cssData});}});}
this.$('div.font-icons-icons').html(QWeb.render('web_editor.dialog.font-icons.icons',{'iconsParser':iconsParser}));},save:function(){var self=this;var style=this.media.attributes.style?this.media.attributes.style.value:'';var classes=(this.media.className||"").split(/\s+/);var custom_classes=/^fa(-[1-5]x|spin|rotate-(9|18|27)0|flip-(horizont|vertic)al|fw|border)?$/;var non_fa_classes=_.reject(classes,function(cls){return self.getFont(cls)||custom_classes.test(cls);});var final_classes=non_fa_classes.concat(this.get_fa_classes());if(this.media.tagName!=="SPAN"){var media=document.createElement('span');$(media).data($(this.media).data());$(this.media).replaceWith(media);this.media=media;style=style.replace(/\s*width:[^;]+/,'');}
$(this.media).attr("class",_.compact(final_classes).join(' ')).attr("style",style);return this.media;},getFont:function(classNames){if(!(classNames instanceof Array)){classNames=(classNames||"").split(/\s+/);}
var fontIcon,cssData;for(var k=0;k<this.iconsParser.length;k++){fontIcon=this.iconsParser[k];for(var s=0;s<fontIcon.cssData.length;s++){cssData=fontIcon.cssData[s];if(_.intersection(classNames,cssData[3]).length){return{'base':fontIcon.base,'parser':fontIcon.parser,'icons':fontIcon.icons,'font':cssData[2]};}}}
return null;},load_data:function(){var classes=(this.media&&this.media.className||"").split(/\s+/);for(var i=0;i<classes.length;i++){var cls=classes[i];switch(cls){case'fa-1x':case'fa-2x':case'fa-3x':case'fa-4x':case'fa-5x':this.$('#fa-size').val(cls);continue;case'fa-spin':case'fa-rotate-90':case'fa-rotate-180':case'fa-rotate-270':case'fa-flip-horizontal':case'fa-rotate-vertical':this.$('#fa-rotation').val(cls);continue;case'fa-fw':continue;case'fa-border':this.$('#fa-border').prop('checked',true);continue;case'':continue;default:this.$(".font-icons-icon").removeClass("o_selected").filter("[data-alias*=',"+cls+",']").addClass("o_selected");if(this.alias.indexOf(cls)!==-1){this.$('#fa-icon').val(cls);}}}},get_fa_classes:function(){var font=this.getFont(this.$('#fa-icon').val());return[font?font.base:'fa',font?font.font:"",this.$('#fa-size').val(),this.$('#fa-rotation').val(),this.$('#fa-border').prop('checked')?'fa-border':''];},clear:function(){this.media.className=this.media.className.replace(/(^|\s)(fa(\s|$)|fa-[^\s]*)/g,' ');},});function createVideoNode(url,options){options=options||{};var ytRegExp=/^(?:(?:https?:)?\/\/)?(?:www\.)?(?:youtu\.be\/|youtube(-nocookie)?\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((?:\w|-){11})(?:\S+)?$/;var ytMatch=url.match(ytRegExp);var igRegExp=/\/\/instagram.com\/p\/(.[a-zA-Z0-9]*)/;var igMatch=url.match(igRegExp);var vRegExp=/\/\/vine.co\/v\/(.[a-zA-Z0-9]*)/;var vMatch=url.match(vRegExp);var vimRegExp=/\/\/(player.)?vimeo.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/;var vimMatch=url.match(vimRegExp);var dmRegExp=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/;var dmMatch=url.match(dmRegExp);var youkuRegExp=/\/\/v\.youku\.com\/v_show\/id_(\w+)\.html/;var youkuMatch=url.match(youkuRegExp);var $video=$('<iframe>');if(ytMatch&&ytMatch[2].length===11){var youtubeId=ytMatch[2];$video=$('<iframe>',{src:'//www.youtube'+(ytMatch[1]||'')+'.com/embed/'+youtubeId,width:'640',height:'360'});}else if(igMatch&&igMatch[0].length){$video=$('<iframe>',{src:igMatch[0]+'/embed/',width:'612',height:'710',scrolling:'no',allowtransparency:'true'});}else if(vMatch&&vMatch[0].length){$video=$('<iframe>',{src:vMatch[0]+'/embed/simple',width:'600',height:'600',class:'vine-embed'});}else if(vimMatch&&vimMatch[3].length){$video=$('<iframe>',{src:'//player.vimeo.com/video/'+vimMatch[3],width:'640',height:'360'});}else if(dmMatch&&dmMatch[2].length){$video=$('<iframe>',{src:'//www.dailymotion.com/embed/video/'+dmMatch[2],width:'640',height:'360'});}else if(youkuMatch&&youkuMatch[1].length){$video=$('<iframe>',{height:'498',width:'510',src:'//player.youku.com/embed/'+youkuMatch[1]});}else{$video=$('<iframe>',{width:'640',height:'360',src:url});}
if(options.autoplay){$video.attr("src",$video.attr("src")+"?autoplay=1");}
$video.attr('frameborder',0);return $video;}
var VideoDialog=Widget.extend({template:'web_editor.dialog.video',events:_.extend({},Dialog.prototype.events,{'click input#urlvideo ~ button':'get_video','click input#embedvideo ~ button':'get_embed_video','change input#autoplay':'get_video','change input#urlvideo':'change_input','keyup input#urlvideo':'change_input','change input#embedvideo':'change_input','keyup input#embedvideo':'change_input','keydown.dismiss.bs.modal':function(){},}),init:function(parent,media){this._super.apply(this,arguments);this.parent=parent;this.media=media;},start:function(){this.$preview=this.$('.preview-container').detach();this.$iframe=this.$("iframe");var $media=$(this.media);if($media.hasClass("media_iframe_video")){var src=$media.data('oe-expression')||$media.data('src');this.$("input#urlvideo").val(src);this.$("input#autoplay").prop("checked",(src||"").indexOf("autoplay")>=0);this.get_video();}
return this._super.apply(this,arguments);},change_input:function(e){var $input=$(e.target);var $button=$input.parent().find("button");if($input.val()===""){$button.addClass("btn-default").removeClass("btn-primary");}else{$button.removeClass("btn-default").addClass("btn-primary");}},get_embed_video:function(event){event.preventDefault();var embedvideo=this.$("input#embedvideo").val().match(/src=["']?([^"']+)["' ]?/);if(embedvideo){this.$("input#urlvideo").val(embedvideo[1]);this.get_video(event);}
return false;},get_video:function(event){if(event)event.preventDefault();var $video=createVideoNode(this.$("input#urlvideo").val(),{autoplay:this.$("input#autoplay").is(":checked")});this.$iframe.replaceWith($video);this.$iframe=$video;return false;},save:function(){var video_id=this.$("#video_id").val();if(!video_id){this.$("button.btn-primary").click();video_id=this.$("#video_id").val();}
var $iframe=$('<div class="media_iframe_video" data-oe-expression="'+this.$iframe.attr("src")+'">'+'<div class="css_editable_mode_display">&nbsp;</div>'+'<div class="media_iframe_video_size" contentEditable="false">&nbsp;</div>'+'<iframe src="'+this.$iframe.attr("src")+'" frameborder="0" allowfullscreen="allowfullscreen" contentEditable="false"></iframe>'+'</div>');$(this.media).replaceWith($iframe);this.media=$iframe[0];return this.media;},clear:function(){if(this.media.dataset.src){try{delete this.media.dataset.src;}catch(e){this.media.dataset.src=undefined;}}
this.media.className=this.media.className.replace(/(^|\s)media_iframe_video(\s|$)/g,' ');},});var LinkDialog=Dialog.extend({template:'web_editor.dialog.link',events:_.extend({},Dialog.prototype.events,{'change :input.url-source':'changed','keyup :input.url':'onkeyup','keyup :input':'preview','click button.remove':'remove_link','change input#link-text':function(e){this.text=$(e.target).val();},'change .link-style':function(e){this.preview();},}),init:function(parent,options,editable,linkInfo){this._super(parent,_.extend({},{title:_t("Link to")},options||{}));this.editable=editable;this.data=linkInfo||{};this.data.className="";if(this.data.range){this.data.iniClassName=$(this.data.range.sc).filter("a").attr("class")||"";this.data.className=this.data.iniClassName.replace(/(^|\s+)btn(-[a-z0-9_-]*)?/gi,' ');var is_link=this.data.range.isOnAnchor();var r=this.data.range;var sc=r.sc;var so=r.so;var ec=r.ec;var eo=r.eo;var nodes;if(!is_link){if(sc.tagName){sc=dom.firstChild(so?sc.childNodes[so]:sc);so=0;}else if(so!==sc.textContent.length){if(sc===ec){ec=sc=sc.splitText(so);eo-=so;}else{sc=sc.splitText(so);}
so=0;}
if(ec.tagName){ec=dom.lastChild(eo?ec.childNodes[eo-1]:ec);eo=ec.textContent.length;}else if(eo!==ec.textContent.length){ec.splitText(eo);}
nodes=dom.listBetween(sc,ec);if(dom.isVoid(sc)||dom.isImg(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode;}
if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode;}else if(dom.isVoid(ec)||dom.isImg(sc)){eo=dom.listPrev(ec).length;ec=ec.parentNode;}
this.data.range=range.create(sc,so,ec,eo);$(editable).data("range",this.data.range);this.data.range.select();}else{nodes=dom.ancestor(sc,dom.isAnchor).childNodes;}
if(dom.isImg(sc)&&nodes.indexOf(sc)===-1){nodes.push(sc);}
if(nodes.length>1||dom.ancestor(nodes[0],dom.isImg)){var text="";this.data.images=[];for(var i=0;i<nodes.length;i++){if(dom.ancestor(nodes[i],dom.isImg)){this.data.images.push(dom.ancestor(nodes[i],dom.isImg));text+='[IMG]';}else if(!is_link&&nodes[i].nodeType===1){}else if(!is_link&&i===0){text+=nodes[i].textContent.slice(so,Infinity);}else if(!is_link&&i===nodes.length-1){text+=nodes[i].textContent.slice(0,eo);}else{text+=nodes[i].textContent;}}
this.data.text=text;}}
this.data.text=this.data.text.replace(/[ \t\r\n]+/g,' ');},start:function(){this.bind_data();this.$('input.url-source:eq(1)').closest('.list-group-item').addClass('active');return this._super.apply(this,arguments);},get_data:function(test){var self=this;var def=new $.Deferred();var $e=this.$('.active input.url-source');if(!$e.length){$e=this.$('input.url-source:first');}
$e.closest('.form-group').removeClass('has-error');var val=$e.val();var label=this.$('#link-text').val()||val;if(label&&this.data.images){for(var i=0;i<this.data.images.length;i++){label=label.replace(/</,"&lt;").replace(/>/,"&gt;").replace(/\[IMG\]/,this.data.images[i].outerHTML);}}
if(!test&&(!val||!$e[0].checkValidity())){$e.closest('.form-group').addClass('has-error');$e.focus();def.reject();}
var style=this.$("input[name='link-style-type']:checked").val()||'';var size=this.$("input[name='link-style-size']:checked").val()||'';var classes=(this.data.className||"")+(style&&style.length?" btn ":"")+style+" "+size;var isNewWindow=this.$('input.window-new').prop('checked');if($e.hasClass('email-address')&&(_.str.startsWith(val,'mailto:')||(val.indexOf("@")!==-1&&!_.str.startsWith(val,'http')&&!_.str.startsWith(val,'www')))){self.get_data_buy_mail(def,$e,isNewWindow,label,classes,test);}else{self.get_data_buy_url(def,$e,isNewWindow,label,classes,test);}
return def;},get_data_buy_mail:function(def,$e,isNewWindow,label,classes,test){var val=$e.val();if(utils.is_email(val,true)){def.resolve(val.indexOf("mailto:")===0?val:'mailto:'+val,isNewWindow,label,classes);}else{$e.closest('.form-group').addClass('has-error');$e.focus();def.reject();}},get_data_buy_url:function(def,$e,isNewWindow,label,classes,test){def.resolve($e.val(),isNewWindow,label,classes);},save:function(){var self=this;var _super=this._super.bind(this);return this.get_data().then(function(url,new_window,label,classes){self.data.url=url;self.data.isNewWindow=new_window;self.data.text=label;self.data.className=classes.replace(/\s+/gi,' ').replace(/^\s+|\s+$/gi,'');if(classes.replace(/(^|[ ])(btn-default|btn-success|btn-primary|btn-info|btn-warning|btn-danger)([ ]|$)/gi,' ')){self.data.style={'background-color':'','color':''};}
self.final_data=self.data;}).then(_super);},bind_data:function(){var href=this.data.url;var new_window=this.data.isNewWindow;var text=this.data.text;var classes=this.data.iniClassName;this.$('input#link-text').val(text);this.$('input.window-new').prop('checked',new_window);if(classes){this.$('input[value!=""]').each(function(){var $option=$(this);if(classes.indexOf($option.val())!==-1){$option.attr("checked","checked");}});}
if(href){var match=/mailto:(.+)/.exec(href);if(match){this.$('input.email-address').val(match=/mailto:(.+)/.exec(href)?match[1]:'');}else{this.$('input.url').val(href);this.$('input.window-new').closest("div").show();}}
this.preview();},changed:function(e){$(e.target).closest('.list-group-item').addClass('active').siblings().removeClass('active').addBack().removeClass('has-error');this.preview();},onkeyup:function(e){var $e=$(e.target);var is_link=($e.val()||'').length&&$e.val().indexOf("@")===-1;this.$('input.window-new').closest("div").toggle(is_link);this.preview();},preview:function(){var $preview=this.$("#link-preview");this.get_data(true).then(function(url,new_window,label,classes){$preview.attr("target",new_window?'_blank':"").attr("href",url&&url.length?url:"#").html((label&&label.length?label:url)).attr("class",classes.replace(/pull-\w+/,'')+" o_btn_preview");});}});return{Dialog:Dialog,alt:alt,MediaDialog:MediaDialog,LinkDialog:LinkDialog,getCssSelectors:getCssSelectors,fontIcons:fontIcons,};});;

/* /web_editor/static/src/js/snippets.editor.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.snippet.editor',function(require){'use strict';var Class=require('web.Class');var ajax=require('web.ajax');var core=require('web.core');var Widget=require('web.Widget');var editor=require('web_editor.editor');var animation=require('web_editor.snippets.animation');var options=require('web_editor.snippets.options');var qweb=core.qweb;var _t=core._t;ajax.loadXML('/web_editor/static/src/xml/snippets.xml',qweb);var data={};$.extend($.expr[':'],{hasData:function(node){return!!_.toArray(node.dataset).length;},data:function(node,i,m){return $(node).data(m[3]);}});data.globalSelector={closest:function(){return $();},all:function(){return $();},is:function(){return false;},};data.Class=Widget.extend({id:"oe_snippets",activeSnippets:[],init:function(parent,$editable){this.$editable=$editable;this._super.apply(this,arguments);if(!$('#oe_manipulators').length){$("<div/>",{id:"oe_manipulators",'class':"o_css_editor"}).appendTo('body');}
this.$active_snipped_id=false;this.snippets=[];data.instance=this;},start:function(){var self=this;$(window).resize(function(){_.defer(function(){$(document).click();});});this.fetch_snippet_templates();this.bind_snippet_click_editor();$(document).on('click','.dropdown-submenu a[tabindex]',function(e){e.preventDefault();});var _isNotBreakable=$.summernote.core.dom.isNotBreakable;$.summernote.core.dom.isNotBreakable=function(node){return _isNotBreakable(node)||$(node).is('div')||data.globalSelector.is($(node));};$(window).on('resize',function(){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.cover_target(self.$active_snipped_id.data("snippet-editor").$overlay,self.$active_snipped_id);}});$(document).on('mousemove',function(){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.$active_snipped_id.data("snippet-editor").$overlay.removeClass('o_keypress');}});$(document).on('keydown',function(event){if(self.$active_snipped_id&&self.$active_snipped_id.data("snippet-editor")){self.$active_snipped_id.data("snippet-editor").$overlay.addClass('o_keypress');}
if((event.metaKey||(event.ctrlKey&&!event.altKey))&&event.shiftKey&&event.keyCode>=48&&event.keyCode<=57){self.$('.scroll:first > ul li:eq('+(event.keyCode-49)+') a').trigger("click");event.preventDefault();}});},_get_snippet_url:function(){return'/web_editor/snippets';},_add_check_selector:function(selector,no_check,is_children){var self=this;selector=selector.split(/\s*,/).join(":not(.o_snippet_not_selectable), ")+":not(.o_snippet_not_selectable)";if(no_check){return{closest:function($from,parentNode){return $from.closest(selector,parentNode);},all:function($from){return $from?cssFind($from,selector):$(selector);},is:function($from){return $from.is(selector);}};}else{selector=selector.split(/\s*,/).join(":o_editable, ")+":o_editable";return{closest:function($from,parentNode){var parents=self.$editable.get();return $from.closest(selector,parentNode).filter(function(){var node=this;while(node.parentNode){if(parents.indexOf(node)!==-1){return true;}
node=node.parentNode;}
return false;});},all:is_children?function($from){return cssFind($from||self.$editable,selector);}:function($from){$from=$from||self.$editable;return $from.filter(selector).add(cssFind($from,selector));},is:function($from){return $from.is(selector);}};}
function cssFind($from,selector){return $from.find('*').filter(selector);}},fetch_snippet_templates:function(){var self=this;var url=this._get_snippet_url();if(!url||!url.length){this.$el.detach();return;}
return ajax.jsonRpc(url,'call',{}).then(function(html){self.compute_snippet_templates(html);self.trigger("snippets:ready");},function(){console.warn('Snippets template not found:',url);});},compute_snippet_templates:function(html){var self=this;var $html=$(html);var $scroll=$html.siblings("#o_scroll");if(!$scroll.length){throw new Error("Wrong snippets xml definition");}
$html.find('[data-oe-type="snippet"]').each(function(){$(this).children().attr('data-oe-type',"snippet").attr('data-oe-thumbnail',$(this).data('oe-thumbnail'));});self.templateOptions=[];var selector=[];var $styles=$html.find("[data-js], [data-selector]");$styles.each(function(){var $style=$(this);var no_check=$style.data('no-check');var option_id=$style.data('js');var option={'option':option_id,'base_selector':$style.data('selector'),'selector':self._add_check_selector($style.data('selector'),no_check),'$el':$style,'drop-near':$style.data('drop-near')&&self._add_check_selector($style.data('drop-near'),no_check,true),'drop-in':$style.data('drop-in')&&self._add_check_selector($style.data('drop-in'),no_check),'data':$style.data()};self.templateOptions.push(option);selector.push(option.selector);});$styles.addClass("hidden");data.globalSelector.closest=function($from){var $temp;var $target;var len=selector.length;for(var i=0;i<len;i++){$temp=selector[i].closest($from,$target&&$target[0]);if(!$target||$temp.length){$target=$temp;}}
return $target;};data.globalSelector.all=function($from){var $target;var len=selector.length;for(var i=0;i<len;i++){if(!$target)$target=selector[i].all($from);else $target=$target.add(selector[i].all($from));}
return $target;};data.globalSelector.is=function($from){var len=selector.length;for(var i=0;i<len;i++){if(selector[i].is($from)){return true;}}
return false;};var number=0;self.$snippets=$scroll.find(".o_panel_body").children().addClass("oe_snippet").each(function(){var $snippet=$(this);if(!$('.oe_snippet_thumbnail',this).size()){var $div=$('<div class="oe_snippet_thumbnail">'+'<div class="oe_snippet_thumbnail_img"/>'+'<span class="oe_snippet_thumbnail_title"></span>'+'</div>');$div.find('span').text($snippet.attr("name"));$snippet.prepend($div);var thumbnail=$("[data-oe-thumbnail]",this).data("oe-thumbnail");if(thumbnail){$div.find('.oe_snippet_thumbnail_img').css('background-image','url('+thumbnail+')');}}
if(!$snippet.data("selector")){$("> *:not(.oe_snippet_thumbnail)",this).addClass('oe_snippet_body');}
number++;});if(!number){this.$el.detach();}
$("body").toggleClass("editor_has_snippets",!!number);this.add_default_snippet_text_classes();$(document).on("click",".o_default_snippet_text",function(event){$(event.target).selectContent();});$(document).on("keyup",function(event){var r=$.summernote.core.range.create();$(r&&r.sc).closest(".o_default_snippet_text").removeClass("o_default_snippet_text");});$html.find('[data-oe-model], [data-oe-type]').each(function(){for(var k=0;k<this.attributes.length;k++){if(this.attributes[k].name.indexOf('data-oe-')===0){$(this).removeAttr(this.attributes[k].name);k--;}}});$html.find('.o_not_editable').attr("contentEditable",false);this.$el.html($html);self.make_snippet_draggable(self.$snippets);this.associate_snippet_names(this.$snippets);this.show_blocks();this.$el.on("snippet-dropped snippet-removed",this.show_blocks.bind(this));},associate_snippet_names:function($snippets){_.each($snippets,function(snippet){var $snippet=$(snippet);var $sbody=$snippet.find(".oe_snippet_body");var snippet_classes=$sbody.attr("class").match(/s_[^ ]+/g);if(snippet_classes&&snippet_classes.length){snippet_classes=snippet_classes.join(".");}
$("#wrapwrap ."+snippet_classes).data("name",$snippet.find(".oe_snippet_thumbnail_title").text());});},add_default_snippet_text_classes:function($in){if($in===undefined){$in=this.$snippets.find(".oe_snippet_body");}
$in.find("*").addBack().contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass("o_default_snippet_text");},cover_target:function($el,$target){if($el.data('not-cover_target')){return;}
var pos=$target.offset();var mt=parseInt($target.css("margin-top")||0);$el.css({width:$target.outerWidth(),left:pos.left,top:pos.top-mt,});$el.find('.oe_handles').css({height:$target.outerHeight(true),});$el.toggleClass('o_top_cover',pos.top<=(this.$('#o_scroll').position().top+15));},show_blocks:function(){var self=this;var cache={};this.$snippets.each(function(){var $snippet=$(this);var $snippet_body=$snippet.find(".oe_snippet_body");var check=false;_.each(self.templateOptions,function(option,k){if(check||!$snippet_body.is(option.base_selector))return;cache[k]=cache[k]||{'drop-near':option['drop-near']?option['drop-near'].all().length:0,'drop-in':option['drop-in']?option['drop-in'].all().length:0};check=(cache[k]['drop-near']||cache[k]['drop-in']);});$snippet.toggleClass("disable",!check);});},bind_snippet_click_editor:function(){var self=this;var snipped_event_flag;$(document).on('click','*',function(event){var srcElement=event.srcElement||(event.originalEvent&&(event.originalEvent.originalTarget||event.originalEvent.target)||event.target);if(self.editor_busy||snipped_event_flag===srcElement||!srcElement){return;}
snipped_event_flag=srcElement;setTimeout(function(){snipped_event_flag=false;},0);var $target=$(srcElement);if($target.closest(".oe_overlay, .note-popover").length){return;}
if(!data.globalSelector.is($target)){$target=data.globalSelector.closest($target);}
if(self.$active_snipped_id&&self.$active_snipped_id.is($target)){return;}
self.make_active($target);});},snippet_blur:function($snippet){if($snippet){if($snippet.data("snippet-editor")){$snippet.data("snippet-editor").on_blur();}}},snippet_focus:function($snippet){if($snippet){if($snippet.data("snippet-editor")){$snippet.data("snippet-editor").on_focus();}}},clean_for_save:function(){var self=this;var opt=options.registry;var template=self.templateOptions;for(var k in template){var Option=opt[template[k]['option']];if(Option&&Option.prototype.clean_for_save!==editor.dummy){template[k].selector.all().filter(function(){var node=this;while(!/o_dirty|o_editable/.test(node.className)&&node!==document){node=node.parentNode;}
return node.className.indexOf("o_dirty")!==-1;}).each(function(){new Option(self,null,$(this),k).clean_for_save();});}}
this.$editable.find("*[contentEditable], *[attributeEditable]").removeAttr('contentEditable').removeProp('contentEditable').removeAttr('attributeEditable').removeProp('attributeEditable');},make_active:function($snippet){if($snippet&&this.$active_snipped_id&&this.$active_snipped_id.get(0)===$snippet.get(0)){return;}
if(this.$active_snipped_id){this.snippet_blur(this.$active_snipped_id);this.$active_snipped_id=false;}
if($snippet&&$snippet.length){if(_.indexOf(this.snippets,$snippet.get(0))===-1){this.snippets.push($snippet.get(0));}
this.$active_snipped_id=$snippet;this.create_snippet_editor(this.$active_snipped_id);this.cover_target($snippet.data('overlay'),$snippet);this.snippet_focus($snippet);}
this.$el.trigger('snippet-activated',$snippet);if($snippet){$snippet.trigger('snippet-activated',$snippet);}},create_snippet_editor:function($snippet){if(typeof $snippet.data("snippet-editor")==='undefined'){if(!this.activate_overlay_zones($snippet).length)return;$snippet.data("snippet-editor",new data.Editor(this,$snippet));}},make_snippet_draggable:function($snippets){var self=this;var $tumb=$snippets.find(".oe_snippet_thumbnail_img:first");var left=$tumb.outerWidth()/2;var top=$tumb.outerHeight()/2;var $toInsert,dropped,$snippet;$snippets.draggable({greedy:true,helper:'clone',zIndex:'1000',appendTo:'body',cursor:"move",handle:".oe_snippet_thumbnail",distance:30,cursorAt:{'left':left,'top':top},start:function(){dropped=false;$snippet=$(this);var $base_body=$snippet.find('.oe_snippet_body');var $selector_siblings=$();var $selector_children=$();var temp=self.templateOptions;for(var k in temp){if($base_body.is(temp[k].base_selector)){if(temp[k]['drop-near']){if(!$selector_siblings)$selector_siblings=temp[k]['drop-near'].all();else $selector_siblings=$selector_siblings.add(temp[k]['drop-near'].all());}
if(temp[k]['drop-in']){if(!$selector_children)$selector_children=temp[k]['drop-in'].all();else $selector_children=$selector_children.add(temp[k]['drop-in'].all());}}}
$toInsert=$base_body.clone().data("name",$snippet.find(".oe_snippet_thumbnail_title").text());if(!$selector_siblings.length&&!$selector_children.length){console.warn($snippet.find(".oe_snippet_thumbnail_title").text()+" have not insert action: data-drop-near or data-drop-in");return;}
self.make_active(false);self.activate_insertion_zones($selector_siblings,$selector_children);$('.oe_drop_zone').droppable({over:function(){dropped=true;$(this).first().after($toInsert).addClass('hidden');},out:function(){var prev=$toInsert.prev();if(this===prev[0]){dropped=false;$toInsert.detach();$(this).removeClass('hidden');}},});},stop:function(ev,ui){$toInsert.removeClass('oe_snippet_body');if(!dropped&&self.$editable.find('.oe_drop_zone')&&ui.position.top>3&&ui.position.left+50>self.$el.outerWidth()){var el=self.$editable.find('.oe_drop_zone').nearest({x:ui.position.left,y:ui.position.top}).first();if(el.length){el.after($toInsert);dropped=true;}}
self.$editable.find('.oe_drop_zone').droppable('destroy').remove();if(dropped){var prev=$toInsert.first()[0].previousSibling;var next=$toInsert.last()[0].nextSibling;var rte=self.getParent().rte;if(prev){$toInsert.detach();rte.historyRecordUndo($(prev));$toInsert.insertAfter(prev);}else if(next){$toInsert.detach();rte.historyRecordUndo($(next));$toInsert.insertBefore(next);}else{var $parent=$toInsert.parent();$toInsert.detach();rte.historyRecordUndo($parent);$parent.prepend($toInsert);}
$toInsert.closest(".o_editable").trigger("content_changed");var $target=false;$target=$toInsert;setTimeout(function(){self.$el.trigger('snippet-dropped',$target);animation.start(true,$target);self.call_for_all_snippets($target,function(editor,$snippet){_.defer(function(){editor.drop_and_build_snippet();});});self.create_snippet_editor($target);self.cover_target($target.data('overlay'),$target);$target.closest(".o_editable").trigger("content_changed");self.make_active($target);},0);}else{$toInsert.remove();}},});},call_for_all_snippets:function($snippet,callback){var self=this;$snippet.add(data.globalSelector.all($snippet)).each(function(){var $snippet=$(this);self.create_snippet_editor($snippet);if($snippet.data("snippet-editor")){callback.call(self,$snippet.data("snippet-editor"),$snippet);}});},get_snippet_from_id:function(id){return $('.oe_snippet').filter(function(){return $(this).data('option')===id;}).first();},activate_insertion_zones:function($selector_siblings,$selector_children){var self=this;var zone_template=$("<div class='oe_drop_zone oe_insert'/>");function isFullWidth($elem){return $elem.parent().width()===$elem.outerWidth(true);}
if($selector_children){$selector_children.each(function(){var $zone=$(this);var css=window.getComputedStyle(this);var float=css.float||css.cssFloat;var $drop=zone_template.clone();$zone.append($drop);var node=$drop[0].previousSibling;var test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==="BR"));if(test){$drop.addClass("oe_vertical").css({'height':parseInt(window.getComputedStyle($zone[0]).lineHeight),'float':'none','display':'inline-block'});}else if(float==="left"||float==="right"){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().last().outerHeight()),30));}}
$drop=$drop.clone();$zone.prepend($drop);node=$drop[0].nextSibling;test=!!(node&&((!node.tagName&&node.textContent.match(/\S/))||node.tagName==="BR"));if(test){$drop.addClass("oe_vertical").css({'height':parseInt(window.getComputedStyle($zone[0]).lineHeight),'float':'none','display':'inline-block'});}else if(float==="left"||float==="right"){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.children().first().outerHeight()),30));}}
if(test){$drop.css({'float':'none','display':'inline-block'});}});$selector_siblings=$(_.uniq(($selector_siblings||$()).add($selector_children.children()).get()));}
if($selector_siblings){$selector_siblings.filter(':not(.oe_drop_zone):not(.oe_drop_clone)').each(function(){var $zone=$(this);var $drop;var css=window.getComputedStyle(this);var float=css.float||css.cssFloat;if($zone.prev('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==="left"||float==="right"){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.prev().outerHeight()||Infinity),30));}}
$zone.before($drop);}
if($zone.next('.oe_drop_zone:visible').length===0){$drop=zone_template.clone();if(float==="left"||float==="right"){$drop.css('float',float);if(!isFullWidth($zone)){$drop.addClass("oe_vertical").css('height',Math.max(Math.min($zone.outerHeight(),$zone.next().outerHeight()||Infinity),30));}}
$zone.after($drop);}});}
var count;do{count=0;$zones=self.$editable.find('.oe_drop_zone > .oe_drop_zone').remove();count+=$zones.length;$zones.remove();}while(count>0);var $zones=self.$editable.find('.oe_drop_zone:not(.oe_vertical)');$zones.each(function(){var zone=$(this);var prev=zone.prev();var next=zone.next();if(prev.is('.oe_drop_zone')||next.is('.oe_drop_zone')){zone.remove();return;}
var float_prev=prev.css('float')||'none';var float_next=next.css('float')||'none';var disp_prev=prev.css('display')||null;var disp_next=next.css('display')||null;if((float_prev==='left'||float_prev==='right')&&(float_next==='left'||float_next==='right')){zone.remove();}else if(!(disp_prev===null||disp_next===null||disp_prev==='block'||disp_next==='block')){zone.remove();}});},activate_overlay_zones:function($targets){var self=this;function is_visible($el){return $el.css('display')!=='none'&&$el.css('opacity')!=='0'&&$el.css('visibility')!=='hidden';}
$targets=$targets.filter(function(){return is_visible($(this));});$targets=$targets.filter(function(){var parents=$(this).parents().filter(function(){return!is_visible($(this));});return parents.length===0;});$targets.each(function(){var $target=$(this);if(!$target.data('overlay')){var $zone=$(qweb.render('web_editor.snippet_overlay'));if(document.body&&document.body.addEventListener){$zone.on("click mousedown mousedown",function passThrough(event){event.preventDefault();$target.each(function(){event.srcElement=this;$(this).trigger(event.type);});return false;});}
$zone.appendTo('#oe_manipulators');$zone.data('target',$target);$target.data('overlay',$zone);var timer;$target.closest('.o_editable').on("content_changed",function(event){clearTimeout(timer);timer=setTimeout(function(){if($target.data('overlay')&&$target.data('overlay').hasClass("oe_active")){self.cover_target($target.data('overlay'),$target);}},50);});var resize=function(){if($zone.parent().length){self.cover_target($zone,$target);}else{$('body').off("resize",resize);}};$('body').on("resize",resize);}
self.cover_target($target.data('overlay'),$target);});return $targets;}});data.Editor=Class.extend({init:function(BuildingBlock,dom){this.buildingBlock=BuildingBlock;this.$target=$(dom);this.$overlay=this.$target.data('overlay');this.init_parent_options();this.load_style_options();if(!this.$target.parent().is(':o_editable')){this.$overlay.find('.oe_snippet_move, .oe_snippet_clone, .oe_snippet_remove').remove();}else{this.$overlay.on('click','.oe_snippet_clone',_.bind(this.on_clone,this));this.$overlay.on('click','.oe_snippet_remove',_.bind(this.on_remove,this));this._drag_and_drop();}},getName:function(){if(this.$target.data("name")!==undefined){return this.$target.data("name");}
if(this.$target.parent(".row").length){return _t("Column");}
return _t("Block");},_drag_and_drop:function(){var self=this;this.dropped=false;this.$overlay.draggable({greedy:true,appendTo:'body',cursor:"move",handle:".oe_snippet_move",cursorAt:{left:18,top:14},helper:function(){var $clone=$(this).clone().css({width:"24px",height:"24px",border:0});$clone.find(".oe_overlay_options >:not(:contains(.oe_snippet_move)), .oe_handle").remove();$clone.find(":not(.glyphicon)").css({position:'absolute',top:0,left:0});$clone.appendTo("body").removeClass("hidden");return $clone;},start:_.bind(self._drag_and_drop_start,self),stop:_.bind(self._drag_and_drop_stop,self)});},_drag_and_drop_after_insert_dropzone:function(){},_drag_and_drop_active_drop_zone:function($zones){var self=this;$zones.droppable({over:function(){$(".oe_drop_zone.hide").removeClass("hide");$(this).addClass("hide").first().after(self.$target);self.dropped=true;},out:function(){$(this).removeClass("hide");self.$target.detach();self.dropped=false;},});},_drag_and_drop_start:function(){var self=this;this.dropped=false;self.buildingBlock.editor_busy=true;self.size={width:self.$target.width(),height:self.$target.height()};self.$target.after("<div class='oe_drop_clone' style='display: none;'/>");self.$target.detach();self.$overlay.addClass("hidden");var $selector_siblings;for(var i=0;i<self.selector_siblings.length;i++){if(!$selector_siblings)$selector_siblings=self.selector_siblings[i].all();else $selector_siblings=$selector_siblings.add(self.selector_siblings[i].all());}
var $selector_children;for(i=0;i<self.selector_children.length;i++){if(!$selector_children)$selector_children=self.selector_children[i].all();else $selector_children=$selector_children.add(self.selector_children[i].all());}
self.buildingBlock.make_active(false);self.buildingBlock.activate_insertion_zones($selector_siblings,$selector_children);$("body").addClass('move-important');self._drag_and_drop_after_insert_dropzone();self._drag_and_drop_active_drop_zone($('.oe_drop_zone'));},_drag_and_drop_stop:function(ev,ui){var self=this;if(!this.dropped){var $el=$.nearest({x:ui.position.left,y:ui.position.top},'.oe_drop_zone').first();if($el.length){$el.after(this.$target);this.dropped=true;}}
$(".oe_drop_zone").droppable('destroy').remove();var prev=this.$target.first()[0].previousSibling;var next=this.$target.last()[0].nextSibling;var $parent=this.$target.parent();var $clone=$(".oe_drop_clone");if(prev===$clone[0]){prev=$clone[0].previousSibling;}else if(next===$clone[0]){next=$clone[0].nextSibling;}
$clone.after(this.$target);this.$overlay.removeClass("hidden");$("body").removeClass('move-important');$clone.remove();if(this.dropped){this.buildingBlock.getParent().rte.historyRecordUndo(this.$target);if(prev){this.$target.insertAfter(prev);}else if(next){this.$target.insertBefore(next);}else{$parent.prepend(this.$target);}
for(var i in this.styles){this.styles[i].on_move();}}
self.buildingBlock.editor_busy=false;self.init_parent_options();_.defer(function(){self.buildingBlock.cover_target(self.$target.data('overlay'),self.$target);});},load_style_options:function(){var self=this;var $styles=this.$overlay.find('.oe_options');var $ul=$styles.find('ul:first');this.styles={};this.selector_siblings=[];this.selector_children=[];var i=0;$ul.append($("<li/>",{"class":"dropdown-header o_main_header",text:this.getName()}).data("editor",this));_.each(this.buildingBlock.templateOptions,function(val,option_id){if(!val.selector.is(self.$target)){return;}
if(val['drop-near'])self.selector_siblings.push(val['drop-near']);if(val['drop-in'])self.selector_children.push(val['drop-in']);var option=val['option'];self.styles[option]=new(options.registry[option]||options.Class)(self.buildingBlock,self,self.$target,option_id);$ul.append(self.styles[option].$el.addClass("snippet-option-"+option));self.styles[option].start();self.styles[option].__order=i++;});$ul.append($("<li/>",{"class":"divider"}));var $parents=this.$target.parents();_.each($parents,function(parent){var parentEditor=$(parent).data("snippet-editor");if(parentEditor){for(var styleName in parentEditor.styles){if(!parentEditor.styles[styleName].preventChildPropagation){$ul.append($("<li/>",{"class":"dropdown-header o_parent_editor_header",text:parentEditor.getName()}).data("editor",parentEditor));break;}}}});if(!this.selector_siblings.length&&!this.selector_children.length){this.$overlay.find(".oe_snippet_move, .oe_snippet_clone").addClass('hidden');}
this.$overlay.find('[data-toggle="dropdown"]').dropdown();},init_parent_options:function(){var self=this;var $button=this.$overlay.find('.oe_snippet_parent');var $parent=data.globalSelector.closest(this.$target.parent());if(!$parent.data("snippet-editor")){this.buildingBlock.create_snippet_editor($parent);}
$button.toggleClass("hidden",$parent.length===0);$button.off("click").on('click',function(event){event.preventDefault();_.defer(function(){self.buildingBlock.make_active($parent);});});},on_clone:function(event){event.preventDefault();var $clone=this.$target.clone(false);this.buildingBlock.getParent().rte.historyRecordUndo(this.$target);this.$target.after($clone);this.buildingBlock.call_for_all_snippets($clone,function(editor,$snippet){for(var i in editor.styles){editor.styles[i].on_clone($snippet,{isCurrent:($snippet.is($clone)),});}});return false;},on_remove:function(event){if(event!==undefined){event.preventDefault();this.buildingBlock.getParent().rte.historyRecordUndo(this.$target);}
this.on_blur();var index=_.indexOf(this.buildingBlock.snippets,this.$target.get(0));this.buildingBlock.call_for_all_snippets(this.$target,function(editor,$snippet){for(var i in editor.styles){editor.styles[i].on_remove();}});delete this.buildingBlock.snippets[index];var $parent=this.$target.parent();this.$target.find("*").andSelf().tooltip("destroy");this.$target.remove();this.$overlay.remove();var node=$parent[0];if(node&&node.firstChild){$.summernote.core.dom.removeSpace(node,node.firstChild,0,node.lastChild,1);if(!node.firstChild.tagName&&node.firstChild.textContent===" "){node.removeChild(node.firstChild);}}
if($parent.closest(":data(\"snippet-editor\")").length){while(!$parent.data("snippet-editor")){var $nextParent=$parent.parent();if($parent.children().length===0&&$parent.text().trim()===""&&!$parent.hasClass("oe_structure")){$parent.remove();}
$parent=$nextParent;}
if($parent.children().length===0&&$parent.text().trim()===""&&!$parent.hasClass("oe_structure")){_.defer(function(){$parent.data("snippet-editor").on_remove();});}}
$(".note-control-selection").hide();$('.o_table_handler').remove();this.buildingBlock.$el.trigger("snippet-removed");return false;},drop_and_build_snippet:function(){for(var i in this.styles){this.styles[i].drop_and_build_snippet();}},on_focus:function(){this._on_focus_blur(true);},on_blur:function(){this._on_focus_blur(false);},_on_focus_blur:function(focus){var do_action=(focus?_do_action_focus:_do_action_blur);var $style_button=this.$overlay.find(".oe_options");var $ul=$style_button.find("ul:first");var $headers=$ul.find(".dropdown-header:data(editor)");_.each($headers,(function(el){var $el=$(el);var styles=_.values($el.data("editor").styles);if($el.data("editor")!==this){styles=_.filter(styles,function(option){return!option.preventChildPropagation;});}
var count=0;_.each(_.sortBy(styles,"__order").reverse(),function(style){if(do_action(style,$el)){count++;}});$el.toggleClass("hidden",count===0);}).bind(this));$style_button.toggleClass("hidden",$ul.children(":not(.o_main_header):not(.divider):not(.hidden)").length===0);this.$overlay.toggleClass("oe_active",!!focus);function _do_action_focus(style,$dest){style.$el.insertAfter($dest);style.on_focus();return(style.$el.length>0);}
function _do_action_blur(style,$dest){style.$el.detach();style.on_blur();return false;}},});editor.Class.include({init:function(){var self=this;var res=this._super.apply(this,arguments);var $editable=this.rte.editable();this.buildingBlock=new data.Class(this,$editable);this.buildingBlock.on("snippets:ready",this,function(){self.trigger("snippets:ready");});return res;},start:function(){this.buildingBlock.insertAfter(this.$el);this.rte.editable().find("*").off('mousedown mouseup click');return this._super.apply(this,arguments);},save:function(){this.buildingBlock.clean_for_save();return this._super.apply(this,arguments);},});editor.Class.include({start:function(){animation.stop();return this._super.apply(this,arguments).then(function(){animation.start(true);});},});return data;});;

/* /web_editor/static/src/js/snippets.options.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.snippets.options',function(require){'use strict';var ajax=require('web.ajax');var Class=require('web.Class');var core=require('web.core');var Dialog=require('web.Dialog');var base=require('web_editor.base');var editor=require('web_editor.editor');var widget=require('web_editor.widget');var qweb=core.qweb;var _t=core._t;var SnippetOption=Class.extend({init:function(BuildingBlock,editor,$target,option_id){this.buildingBlock=BuildingBlock;this.editor=editor;this.$target=$target;this.option=option_id;var option=this.buildingBlock.templateOptions[option_id];this.$el=option.$el.children("li").clone();this.data=option.$el.data();this.$overlay=this.$target.data('overlay')||$();},$:function(){return this.$target.find.apply(this.$target,arguments);},_bind_li_menu:function(){this.$el.filter("li:hasData").find('a:first').off('mouseenter click').on('mouseenter click',_.bind(_mouse,this));this.$el.off('mouseenter click',"li:hasData a").on('mouseenter click',"li:hasData a",_.bind(_mouse,this));this.$el.off('mouseleave').on('mouseleave',_.bind(this.reset,this));this.$el.off('mouseleave',"ul").on('mouseleave',"ul",_.bind(this.reset,this));this.methodsToReset=[];function _mouse(event){var $next=$(event.currentTarget).parent();this.select(event.type==="click"?"click":"over",$next);if(event.type==='click'){this.set_active();this.$target.trigger("snippet-option-change",[this]);}else{this.$target.trigger("snippet-option-preview",[this]);}}},set_active:function(){var self=this;this.$el.find('[data-toggle_class], [data-select_class]').addBack('[data-toggle_class], [data-select_class]').removeClass("active").filter(function(){var $elem=$(this);var className=$elem.data("toggle_class")||$elem.data("select_class");return self.$target.hasClass(className);}).addClass("active");},start:function(){this.set_active();this.$target.on('snippet-option-reset',_.bind(this.set_active,this));this._bind_li_menu();},on_focus:function(){this._bind_li_menu();},on_blur:function(){},on_clone:function($clone){},on_move:function(){},on_remove:function(){},drop_and_build_snippet:function(){},reset:function(){var self=this;var lis=this.$el.find("li.active").addBack('.active').get();_.each(lis.reverse(),function(li){var $li=$(li);for(var k in self.methodsToReset){var method=self.methodsToReset[k];if($li.closest('[data-'+method+']').length){delete self.methodsToReset[k];}}
self.select("reset",$li);});for(var k in this.methodsToReset){var method=this.methodsToReset[k];if(method){this[method]("reset",null);}}
this.methodsToReset=[];this.$target.trigger("snippet-option-reset",[this]);},select:function(type,$li){if($li.data('only')&&type!==$li.data('only')){return;}
if(type==="click"){this.reset();this.buildingBlock.getParent().rte.historyRecordUndo(this.$target);}
var el=$li[0];var methods=[];do{var m=_.omit(el.dataset,["oeId","oeModel","oeField","oeXpath","oeSourceId","only"]);if(_.keys(m).length){methods.push([el,m]);}
el=el.parentNode;}while(this.$el.parent().has(el).length);var self=this;_.each(methods.reverse(),function(data){var $el=$(data[0]);var methods=data[1];for(var k in methods){if(self[k]){if(type!=="reset"&&self.methodsToReset.indexOf(k)===-1){self.methodsToReset.push(k);}
self[k](type,methods[k],$el);}else{console.error("'"+self.option+"' snippet option have not method '"+k+"'");}}});},toggle_class:function(type,value,$li){var $lis=this.$el.find("[data-toggle_class]").addBack("[data-toggle_class]");function map($lis){return $lis.map(function(){return $(this).data("toggle_class");}).get().join(" ");}
var classes=map($lis);var active_classes=map($lis.filter('.active, :has(.active)'));this.$target.removeClass(classes).addClass(active_classes);if(type!=='reset'){this.$target.toggleClass(value);}},select_class:function(type,value,$li){var $lis=this.$el.find("[data-select_class]").addBack("[data-select_class]");var classes=$lis.map(function(){return $(this).data("select_class");}).get().join(" ");this.$target.removeClass(classes);if(value){this.$target.addClass(value);}},eval:function(type,value,$li){var fn=new Function("node","type","value","$li",value);fn.call(this,this,type,value,$li);},clean_for_save:editor.dummy});var registry={};registry.marginAndResize=SnippetOption.extend({preventChildPropagation:true,start:function(){var self=this;this._super();var resize_values=this.getSize();if(resize_values.n)this.$overlay.find(".oe_handle.n").removeClass("readonly");if(resize_values.s)this.$overlay.find(".oe_handle.s").removeClass("readonly");if(resize_values.e)this.$overlay.find(".oe_handle.e").removeClass("readonly");if(resize_values.w)this.$overlay.find(".oe_handle.w").removeClass("readonly");if(resize_values.size)this.$overlay.find(".oe_handle.size").removeClass("readonly");var $auto_size=this.$overlay.find(".oe_handle.size .auto_size");var $fixed_size=this.$overlay.find(".oe_handle.size .size");var auto_sized=isNaN(parseInt(self.$target.prop("style").height));$fixed_size.toggleClass("active",!auto_sized);$auto_size.toggleClass("active",auto_sized);$fixed_size.add(this.$overlay.find(".oe_handle:not(.size)")).on('mousedown',function(event){event.preventDefault();var $handle=$(this);var resize_values=self.getSize();var compass=false;var XY=false;if($handle.hasClass('n')){compass='n';XY='Y';}
else if($handle.hasClass('s')){compass='s';XY='Y';}
else if($handle.hasClass('e')){compass='e';XY='X';}
else if($handle.hasClass('w')){compass='w';XY='X';}
else if($handle.hasClass('size')){compass='size';XY='Y';}
var resize=resize_values[compass];if(!resize)return;if(compass==='size'){var offset=self.$target.offset().top;if(self.$target.css("background").match(/rgba\(0, 0, 0, 0\)/)){self.$target.addClass("resize_editor_busy");}}else{var xy=event['page'+XY];var current=resize[2]||0;var margin_dir={s:'bottom',n:'top',w:'left',e:'right'}[compass];var real_margin=parseInt(self.$target.css('margin-'+margin_dir));_.each(resize[0],function(val,key){if(self.$target.hasClass(val)){current=key;}else if(resize[1][key]===real_margin){current=key;}});var begin=current;var beginClass=self.$target.attr("class");var regClass=new RegExp("\\s*"+resize[0][begin].replace(/[-]*[0-9]+/,'[-]*[0-9]+'),'g');}
self.buildingBlock.editor_busy=true;var cursor=$handle.css("cursor")+'-important';var $body=$(document.body);$body.addClass(cursor);var body_mousemove=function(event){event.preventDefault();if(compass==='size'){var dy=event.pageY-offset;dy=dy-dy%resize;if(dy<=0)dy=resize;self.$target.css("height",dy+"px");self.$target.css("overflow","hidden");self.on_resize(compass,null,dy);self.buildingBlock.cover_target(self.$overlay,self.$target);return;}
var dd=event['page'+XY]-xy+resize[1][begin];var next=current+1===resize[1].length?current:(current+1);var prev=current?(current-1):0;var change=false;if(dd>(2*resize[1][next]+resize[1][current])/3){self.$target.attr("class",(self.$target.attr("class")||'').replace(regClass,''));self.$target.addClass(resize[0][next]);current=next;change=true;}
if(prev!==current&&dd<(2*resize[1][prev]+resize[1][current])/3){self.$target.attr("class",(self.$target.attr("class")||'').replace(regClass,''));self.$target.addClass(resize[0][prev]);current=prev;change=true;}
if(change){self.on_resize(compass,beginClass,current);self.buildingBlock.cover_target(self.$overlay,self.$target);}};var body_mouseup=function(){$body.unbind('mousemove',body_mousemove);$body.unbind('mouseup',body_mouseup);$body.removeClass(cursor);setTimeout(function(){self.buildingBlock.editor_busy=false;if(begin!==current){self.buildingBlock.getParent().rte.historyRecordUndo(self.$target,'resize_'+XY);}},0);self.$target.removeClass("resize_editor_busy");if(compass==="size"){$fixed_size.addClass("active");$auto_size.removeClass("active");}};$body.mousemove(body_mousemove);$body.mouseup(body_mouseup);});$auto_size.on('click',function(){self.$target.css("height","");self.$target.css("overflow","");self.buildingBlock.getParent().rte.historyRecordUndo(self.$target,'resize_Y');self.buildingBlock.cover_target(self.$overlay,self.$target);$fixed_size.removeClass("active");$auto_size.addClass("active");return false;});},getSize:function(){this.grid={};return this.grid;},on_focus:function(){this._super();this.change_cursor();},change_cursor:function(){var _class=this.$target.attr("class")||"";var col=_class.match(/col-md-([0-9-]+)/i);col=col?+col[1]:0;var offset=_class.match(/col-md-offset-([0-9-]+)/i);offset=offset?+offset[1]:0;var overlay_class=this.$overlay.attr("class").replace(/(^|\s+)block-[^\s]*/gi,'');if(col+offset>=12)overlay_class+=" block-e-right";if(col===1)overlay_class+=" block-w-right block-e-left";if(offset===0)overlay_class+=" block-w-left";var mb=_class.match(/mb([0-9-]+)/i);mb=mb?+mb[1]:parseInt(this.$target.css('margin-bottom'));if(mb>=128)overlay_class+=" block-s-bottom";else if(!mb)overlay_class+=" block-s-top";var mt=_class.match(/mt([0-9-]+)/i);mt=mt?+mt[1]:parseInt(this.$target.css('margin-top'));if(mt>=128)overlay_class+=" block-n-top";else if(!mt)overlay_class+=" block-n-bottom";this.$overlay.attr("class",overlay_class);},on_resize:function(){this.change_cursor();}});registry["margin-y"]=registry.marginAndResize.extend({preventChildPropagation:true,getSize:function(){this.grid=this._super();var grid=[0,4,8,16,32,48,64,92,128];this.grid={n:[_.map(grid,function(v){return'mt'+v;}),grid],s:[_.map(grid,function(v){return'mb'+v;}),grid],size:null};return this.grid;},});registry.resize=registry.marginAndResize.extend({preventChildPropagation:true,getSize:function(){this.grid=this._super();this.grid.size=8;return this.grid;},});registry.colorpicker=SnippetOption.extend({start:function(){var self=this;var res=this._super.apply(this,arguments);if(!this.$el.find('.colorpicker').length){var $pt=$(qweb.render('web_editor.snippet.option.colorpicker'));var $clpicker=$(qweb.render('web_editor.colorpicker'));var excluded=[];if(this.data.paletteExclude){excluded=this.data.paletteExclude.replace(/ /g,'').split(',');}
if(this.data.paletteTitle){$pt.find('.note-palette-title').text(this.data.paletteTitle);}
var $toggles=$pt.find('.o_colorpicker_section_menu');var $tabs=$pt.find('.o_colorpicker_section_tabs');_.each(excluded,function(exc){$clpicker.find('[data-name="'+exc+'"]').remove();});var $sections=$clpicker.find('.o_colorpicker_section');if($sections.length>1){$sections.each(function(){var $section=$(this);var id='o_palette_'+$section.data('name')+_.uniqueId();var $li=$('<li/>').append($('<a/>',{href:'#'+id}).append($('<i/>',{'class':$section.data('iconClass')||'',html:$section.data('iconContent')||''})));$toggles.append($li);$tabs.append($section.addClass('tab-pane').attr('id',id));});if(this.data.paletteDefault){var $palette_def=$tabs.find('div[data-name="'+self.data.paletteDefault+'"]');var pos=$tabs.find('> div').index($palette_def);$toggles.children('li').eq(pos).addClass('active');$palette_def.addClass('active');}else{$toggles.find('li').first().addClass('active');$tabs.find('div').first().addClass('active');}
$toggles.on('click mouseover','> li > a',function(e){e.preventDefault();e.stopPropagation();$(this).tab('show');});}else if($sections.length===1){$tabs.addClass('o_unique_palette').append($sections.addClass('tab-pane active'));}else{$toggles.parent().empty().append($clpicker);}
this.$el.find('li').append($pt);}
if(this.$el.data('area')){this.$target=this.$target.find(this.$el.data('area'));this.$el.removeData('area').removeAttr('area');}
var classes=[];this.$el.find(".colorpicker button").each(function(){var $color=$(this);if(!$color.data("color")){return;}
var className='bg-'+$color.data('color');$color.addClass(className);if(self.$target.hasClass(className)){self.color=className;$color.addClass("selected");}
classes.push(className);});this.classes=classes.join(" ");this.bind_events();return res;},bind_events:function(){var self=this;var $colors=this.$el.find(".colorpicker button");$colors.mouseenter(function(e){self.$target.removeClass(self.classes);var color=$(this).data("color");if(color){self.$target.addClass('bg-'+color);}
self.$target.trigger("background-color-event",e.type);}).mouseleave(function(e){self.$target.removeClass(self.classes);var $selected=$colors.filter(".selected");var color=$selected.length&&$selected.data("color");if(color){self.$target.addClass('bg-'+color);}
self.$target.trigger("background-color-event",e.type);}).click(function(e){$colors.removeClass("selected");$(this).addClass("selected");self.$target.closest(".o_editable").trigger("content_changed");self.$target.trigger("background-color-event",e.type);});this.$el.find('.note-color-reset').on('click',function(){self.$target.removeClass(self.classes);self.$target.trigger('content_changed');$colors.removeClass("selected");});}});registry.background=SnippetOption.extend({start:function(){var res=this._super.apply(this,arguments);this.bind_bg_events();return res;},bind_bg_events:function(){this.$target.off(".background-option").on("background-color-event.background-option",(function(e,type){e.stopPropagation();if(e.currentTarget!==e.target)return;this.$el.find("li:first > a").trigger(type);}).bind(this));},background:function(type,value,$li){if(value&&value.length){this.$target.css("background-image","url("+value+")");this.$target.addClass("oe_img_bg");}else{this.$target.css("background-image","");this.$target.removeClass("oe_img_bg oe_custom_bg");}},select_class:function(type,value,$li){this.background(type,'',$li);this._super(type,value?(value+" oe_img_bg"):value,$li);},choose_image:function(type,value,$li){if(type!=="click"){return;}
var $image=$("<img/>",{"class":"hidden","src":value}).appendTo(this.$target);var _editor=new widget.MediaDialog(null,{},null,$image[0]).open();_editor.$('[href="#editor-media-video"], [href="#editor-media-icon"]').addClass('hidden');_editor.on('save',this,function(){var value=$image.attr("src");this.background(type,value,$li);this.$target.addClass("oe_custom_bg");this.set_active();this.$target.trigger("snippet-option-change",[this]);});_editor.on('closed',this,function(){$image.remove();});},set_active:function(){this._super.apply(this,arguments);var src=this.$target.css("background-image").replace(/url\(['"]*|['"]*\)|^none$/g,"");if(this.$target.hasClass('oe_custom_bg')){this.$el.find('li[data-choose_image]').data("background",src).attr("data-background",src);}
this.$el.find('li[data-background]').removeClass("active").filter(function(){var bgOption=$(this).data("background");return(bgOption===""&&src===""||bgOption!==""&&src.indexOf(bgOption)>=0);}).addClass("active");}});registry.background_position=SnippetOption.extend({start:function(){this._super.apply(this,arguments);this.on_focus();var self=this;this.$target.on("snippet-option-change",function(){self.on_focus();});},on_focus:function(){this._super.apply(this,arguments);this.$el.toggleClass('hidden',this.$target.css('background-image')==='none');},background_position:function(type,value,$li){if(type!='click'){return;}
var self=this;this.previous_state=[this.$target.attr('class'),this.$target.css('background-size'),this.$target.css('background-position')];this.bg_pos=self.$target.css('background-position').split(' ');this.bg_siz=self.$target.css('background-size').split(' ');this.modal=new Dialog(null,{title:_t("Background Image Sizing"),$content:$(qweb.render('web_editor.dialog.background_position')),buttons:[{text:_t("Ok"),classes:"btn-primary",close:true,click:_.bind(this.save,this)},{text:_t("Discard"),close:true,click:_.bind(this.discard,this)},],}).open();this.modal.opened().then(function(){var value=((self.$target.hasClass('o_bg_img_opt_contain'))?'contain':((self.$target.hasClass('o_bg_img_opt_custom'))?'custom':'cover'));self.modal.$("> label > input[value="+value+"]").prop('checked',true);if(self.$target.hasClass("o_bg_img_opt_repeat")){self.modal.$("#o_bg_img_opt_contain_repeat").prop('checked',true);self.modal.$("#o_bg_img_opt_custom_repeat").val('o_bg_img_opt_repeat');}else if(self.$target.hasClass("o_bg_img_opt_repeat_x")){self.modal.$("#o_bg_img_opt_custom_repeat").val('o_bg_img_opt_repeat_x');}else if(self.$target.hasClass("o_bg_img_opt_repeat_y")){self.modal.$("#o_bg_img_opt_custom_repeat").val('o_bg_img_opt_repeat_y');}
if(self.bg_pos.length>1){self.bg_pos={x:self.bg_pos[0],y:self.bg_pos[1],};self.modal.$("#o_bg_img_opt_custom_pos_x").val(self.bg_pos.x.replace('%',''));self.modal.$("#o_bg_img_opt_custom_pos_y").val(self.bg_pos.y.replace('%',''));}
if(self.bg_siz.length>1){self.modal.$("#o_bg_img_opt_custom_size_x").val(self.bg_siz[0].replace('%',''));self.modal.$("#o_bg_img_opt_custom_size_y").val(self.bg_siz[1].replace('%',''));}
self.$focus=self.modal.$(".o_focus_point");self.update_pos_information();var img_url=/\(['"]?([^'"]+)['"]?\)/g.exec(self.$target.css('background-image'));img_url=(img_url&&img_url[1])||'';var $img=$('<img/>',{'class':'img img-responsive',src:img_url});$img.on('load',function(){self.bind_img_events($img);});$img.prependTo(self.modal.$(".o_bg_img_opt_object"));self.modal.$el.on('change','> label > input',function(e){self.modal.$('> .o_bg_img_opt').addClass('o_hidden').filter("[data-value="+e.target.value+"]").removeClass('o_hidden');});self.modal.$el.on('change','input, select',function(e){self.save();});self.modal.$("> label > input:checked").trigger('change');});},bind_img_events:function($img){var self=this;var mousedown=false;$img.on('mousedown',function(e){mousedown=true;});$img.on('mousemove',function(e){if(mousedown){_update(e);}});$img.on('mouseup',function(e){self.$focus.addClass('o_with_transition');_update(e);setTimeout(function(){self.$focus.removeClass('o_with_transition');},200);mousedown=false;});function _update(e){var posX=e.pageX-$(e.target).offset().left;var posY=e.pageY-$(e.target).offset().top;self.bg_pos={x:clip_value(posX/$img.width()*100).toFixed(2)+'%',y:clip_value(posY/$img.height()*100).toFixed(2)+'%',};self.update_pos_information();self.save();}
function clip_value(value){return Math.max(0,Math.min(value,100));}},update_pos_information:function(){this.modal.$(".o_bg_img_opt_ui_info .o_x").text(this.bg_pos.x);this.modal.$(".o_bg_img_opt_ui_info .o_y").text(this.bg_pos.y);this.$focus.css({left:this.bg_pos.x,top:this.bg_pos.y,});},save:function(){this.clean();var bg_img_size=this.modal.$('> :not(label):not(.o_hidden)').data('value')||'cover';switch(bg_img_size){case"cover":this.$target.css('background-position',this.bg_pos.x+' '+this.bg_pos.y);break;case"contain":this.$target.addClass('o_bg_img_opt_contain');this.$target.toggleClass('o_bg_img_opt_repeat',this.modal.$("#o_bg_img_opt_contain_repeat").prop("checked"));break;case"custom":this.$target.addClass('o_bg_img_opt_custom');var sizeX=this.modal.$("#o_bg_img_opt_custom_size_x").val();var sizeY=this.modal.$("#o_bg_img_opt_custom_size_y").val();var posX=this.modal.$("#o_bg_img_opt_custom_pos_x").val();var posY=this.modal.$("#o_bg_img_opt_custom_pos_y").val();this.$target.addClass(this.modal.$("#o_bg_img_opt_custom_repeat").val()).css({'background-size':((sizeX)?sizeX+'%':'auto')+" "+((sizeY)?sizeY+'%':'auto'),'background-position':((posX)?posX+'%':'auto')+" "+((posY)?posY+'%':'auto'),});break;}},discard:function(){this.clean();if(this.previous_state){this.$target.addClass(this.previous_state[0]).css({'background-size':this.previous_state[1],'background-position':this.previous_state[2],});}},clean:function(){this.$target.removeClass('o_bg_img_opt_contain o_bg_img_opt_custom o_bg_img_opt_repeat o_bg_img_opt_repeat_x o_bg_img_opt_repeat_y').css({'background-size':'','background-position':'',});},});registry.many2one=SnippetOption.extend({start:function(){var self=this;this.Model=this.$target.data('oe-many2one-model');this.ID=+this.$target.data('oe-many2one-id');this.$btn=$(qweb.render("web_editor.many2one.button")).insertAfter(this.$overlay.find('.oe_options'));this.$ul=this.$btn.find("ul");this.$search=this.$ul.find('li:first');this.$search.find('input').on('mousedown click mouseup keyup keydown',function(e){e.stopPropagation();});setTimeout(function(){if(self.$overlay.find('.oe_options').hasClass('hidden')){self.$btn.css('height','0').find('> a').addClass('hidden');self.$ul.show().css({'top':'-24px','margin':'0','padding':'2px 0','position':'relative'});}else{self.$btn.find('a').on('click',function(e){self.clear();});}},0);this.$search.find('input').focus().on('keyup',function(e){self.find_existing($(this).val());});this.$ul.on('click',"li:not(:first) a",function(e){self.select_record(this);});},on_focus:function(){this.$target.attr('contentEditable','false');this.clear();this._super.apply(this,arguments);},clear:function(){var self=this;this.$search.siblings().remove();self.$search.find('input').val("");setTimeout(function(){self.$search.find('input').focus();},0);},find_existing:function(name){var self=this;var domain=[];if(!name||!name.length){self.$search.siblings().remove();return;}
if(isNaN(+name)){if(this.Model!=="res.partner"){domain.push(['name','ilike',name]);}else{domain.push('|',['name','ilike',name],['email','ilike',name]);}}else{domain.push(['id','=',name]);}
ajax.jsonRpc('/web/dataset/call_kw','call',{model:this.Model,method:'search_read',args:[domain,this.Model==="res.partner"?['name','display_name','city','country_id']:['name','display_name']],kwargs:{order:'name DESC',limit:5,context:base.get_context(),}}).then(function(result){self.$search.siblings().remove();self.$search.after(qweb.render("web_editor.many2one.search",{contacts:result}));});},get_contact_rendering:function(options){return ajax.jsonRpc('/web/dataset/call_kw','call',{model:'ir.qweb.field.contact',method:'get_record_to_html',args:[[this.ID]],kwargs:{options:options,context:base.get_context(),}});},select_record:function(li){var self=this;this.ID=+$(li).data("id");this.$target.attr('data-oe-many2one-id',this.ID).data('oe-many2one-id',this.ID);this.buildingBlock.getParent().rte.historyRecordUndo(this.$target);this.$target.trigger('content_changed');if(self.$target.data('oe-type')==="contact"){$('[data-oe-contact-options]').filter('[data-oe-model="'+self.$target.data('oe-model')+'"]').filter('[data-oe-id="'+self.$target.data('oe-id')+'"]').filter('[data-oe-field="'+self.$target.data('oe-field')+'"]').filter('[data-oe-contact-options!="'+self.$target.data('oe-contact-options')+'"]').add(self.$target).attr('data-oe-many2one-id',self.ID).data('oe-many2one-id',self.ID).each(function(){var $node=$(this);self.get_contact_rendering($node.data('oe-contact-options')).then(function(html){$node.html(html);});});}else{self.$target.html($(li).data("name"));}
setTimeout(function(){self.buildingBlock.make_active(false);},0);}});return{Class:SnippetOption,registry:registry,};});;

/* /web_editor/static/src/js/tour.rte.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.tour',function(require){"use strict";var tour=require("web_tour.tour");var base=require("web_editor.base");var snippet_editor=require('web_editor.snippet.editor');var click_event=function(el,type){var evt=document.createEvent("MouseEvents");evt.initMouseEvent(type,true,true,window,0,0,0,0,0,false,false,false,false,0,el);el.dispatchEvent(evt);};tour.register("rte",{url:'/web_editor/field/html?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',test:true,wait_for:base.ready(),},[{content:"Change html for this test",trigger:"#editable_area",run:function(){var html='\n'+'<section>\n'+'    <div class="container" style="width: 600px;">\n'+'        <div class="row">\n'+'            <div class="col-md-6 mt16">\n'+'<h1 id="text_content_id">Batnae municipium in Anthemusia</h1>     \n'+'     <p>Batnae municipium in Anthemusia conditum Macedonum manu priscorum ab Euphrate flumine brevi spatio disparatur, refertum mercatoribus opulentis, ubi annua sollemnitate prope Septembris initium mensis ad.</p>\n'+'     <p>    Quam <img style="width: 25%" src="/web/static/src/img/logo.png"/> quidem <span class="fa fa-flag fa-2x"></span> partem accusationis admiratus sum et moleste tuli potissimum esse Atratino datam. Neque enim decebat neque aetas.</p>\n'+'     <p>Et hanc quidem praeter oppida multa duae civitates exornant Seleucia opus Seleuci regis, et Claudiopolis quam deduxit coloniam Claudius Caesar. Isaura enim antehac nimium potens, olim subversa ut rebellatrix.</p>'+'<p>Harum trium sententiarum nulli prorsus assentior.</p>\n'+'        </div>\n'+'        <div class="col-md-6 mt16">\n'+'            <img class="img img-responsive shadow mb16" src="/web/static/src/img/logo.png" alt="Odoo text and image block">\n'+'        </div>\n'+'    </div>\n'+'</section>\n';this.$anchor.html(html);}},{content:"simulate triple click and change text bg-color",trigger:'#editable_area > section .row > div:first',run:function(){var $h1=$('h1',this.$anchor);$.summernote.core.range.create($h1[0].firstChild,0,$('p',this.$anchor)[0],0).select();click_event($h1[0],'mouseup');}},{content:"change text bg-color after triple click",trigger:'.note-popover button[data-event="color"]',extra_trigger:'#editable_area > section .row > div:first',},{content:"change selection to change text color",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1 font',run:function(){$.summernote.core.range.create(this.$anchor[0].firstChild,5,this.$anchor[0].firstChild,10).select();click_event(this.$anchor[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle",},{content:"change text color",trigger:"button[data-event=foreColor]:first",},{content:"change selection to change text bg-color again",trigger:'#editable_area > section .row > div:first h1 font:eq(2)',run:function(){$.summernote.core.range.create(this.$anchor.prev()[0].firstChild,3,this.$anchor[0].firstChild,10).select();click_event(this.$anchor.prev()[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle",},{content:"change text backColor again",trigger:"button[data-event=backColor]:visible:first",},{content:"change selection (h1 and p) to change text color with class",trigger:'#editable_area > section .row > div:first h1 font:eq(4)',run:function(){$.summernote.core.range.create(this.$anchor.prev()[0].firstChild,3,this.$anchor.parent("h1").next("p")[0].firstChild,30).select();click_event(this.$anchor.prev()[0],'mouseup');}},{content:"open color dropdown",trigger:".note-color button.dropdown-toggle",},{content:"change text color again",trigger:"button[data-event=foreColor]:visible:eq(3)",},{content:"delete selection",trigger:'.o_editable.note-editable.o_dirty',extra_trigger:'#editable_area > section .row > div:first p font',run:"keydown 46",},{content:"create an other selection to delete",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',extra_trigger:'.o_editable.note-editable.o_dirty',run:function(){$.summernote.core.range.createFromNode(this.$anchor.next("p")[0]).clean();$.summernote.core.range.create(this.$anchor.find('font:containsExact(ici)')[0].firstChild,1,this.$anchor.next().next()[0].firstChild,5).select();click_event(this.$anchor.find('font:last')[0],'mouseup');},},{content:"clean and delete (backspace) an other selection",trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',run:"keydown 8",},{content:"an other selection",trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',extra_trigger:'.o_editable.note-editable.o_dirty',run:function(){$.summernote.core.range.create(this.$anchor.find('font:first')[0].firstChild,3,this.$anchor.next("p")[0].childNodes[2],8).select();click_event(this.$anchor.find('font:first')[0],'mouseup');},},{content:"delete an other selection",trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) ) h1',run:"keydown 46",},{content:"undo",trigger:'.note-image-popover button[data-event="undo"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(Bat) )',},{content:"undo again",trigger:'.note-air-popover button[data-event="undo"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) )',},{content:"delete (backspace) after undo",trigger:'.o_editable.note-editable.o_dirty',extra_trigger:'#editable_area > section .row > div:first:not(:has(p font)) h1',run:"keydown 8",},{content:"click on image",trigger:'#editable_area > section .row > div:first img[style*="25%"]',extra_trigger:'#editable_area > section .row > div:first:has( font:last:containsExact(i) ):has( p:first:containsRegex(/^uam/) )',},{content:"Click on resize half",trigger:'.note-image-popover:visible button[data-event="resize"][data-value="0.5"]',},{content:"Click on edit picture",trigger:'.note-image-popover:visible button[data-event="showImageDialog"]',extra_trigger:'#editable_area > section .row > div:first img[style*="50%"]',},{content:"Click on pictogram tab",trigger:'a[data-toggle="tab"]:contains(Pictogram)',extra_trigger:'#editor-media-image',},{content:"select a pictogram",trigger:'#editor-media-icon.active span.fa:first',},{content:"save pictogram",trigger:'button.o_save_button',extra_trigger:'#editor-media-icon.active span.o_selected',},{content:"select a size for the pictogram",trigger:'.note-image-popover button[data-event="resizefa"][data-value="3"]',},{content:"click on float right",trigger:'.note-image-popover:visible button[data-event="floatMe"][data-value="right"]',extra_trigger:'#wrapwrap span.fa-3x',},{content:"click on create link",trigger:'.note-image-popover:visible button[data-event="showLinkDialog"]',extra_trigger:'#editable_area > section .row > div:first span.fa.pull-right',},{content:"click on color style",trigger:'.dropdown:has(.link-style) a[data-toggle="dropdown"]',extra_trigger:'a#link-preview:containsRegex(/^<span [^>]+><\\/span>$/) > span.fa.fa-3x.pull-right',},{content:"choose success style",trigger:'.dropdown ul label.btn-success',},{content:"insert a link url",trigger:'#link-external',extra_trigger:'a#link-preview.btn',run:"text http://www.odoo.com",},{content:"change text label",trigger:'#link-text',run:"text ABC[IMG] DEF",},{content:"save link",trigger:'button.o_save_button',extra_trigger:'a#link-preview.btn:containsRegex(/^ABC<span [^>]+><\\/span> DEF$/)',},{content:"click on other picture",trigger:'#editable_area > section .row > div:last img',extra_trigger:'body:not(:has(#link-preview)) a.btn[href^="http://"]:has(span.fa.fa-3x.pull-right)',},{content:"click on create link again",trigger:'.note-image-popover:visible button[data-event="showLinkDialog"]',extra_trigger:'#editable_area > section .row > div:first span.fa.pull-right',},{content:"click on color style again",trigger:'.dropdown:has(label.btn-success) a[data-toggle="dropdown"]',extra_trigger:'a#link-preview:containsRegex(/^<img [^>]+>$/) img',},{content:"choose success style",trigger:'.dropdown ul label.btn-success',},{content:"insert an email",trigger:'#link-external',extra_trigger:'a#link-preview.btn',run:"text test@test.test",},{content:"save link",trigger:'button.o_save_button',extra_trigger:'a#link-preview.btn[href="mailto:test@test.test"]',},{content:"select for triple enter then double backspace",trigger:'#editable_area > section .row > div:first p:eq(2)',extra_trigger:'body:not(:has(#link-preview)) #editable_area > section .row > div:eq(1) > a > img',run:function(){var p=this.$anchor[0].firstChild;$.summernote.core.range.create(p,p.textContent.length,p,p.textContent.length).select();click_event(p,'mouseup');},},{content:"triple enter then double backspace",trigger:'#editable_area > section .row > div:first p:eq(2)',run:"keydown 66,13,66,13,13,8,8",},{content:"add ul content",trigger:'#editable_area > section .row > div:first',extra_trigger:'body:not(:has(#editable_area > section .row > div:first p:eq(4), #editable_area > section .row > div:eq(3))) #editable_area > section .row > div:first p:eq(3)',run:function(){var html='  <ul>     '+'\n     <li>   <p>Batnae municipium.  </p></li>'+'\n     <li>    Seleucia praeter.</li>'+'\n     <li><p>Et hanc quidem.</p></li>'+'\n    </ul>';this.$anchor.append(html);var node=this.$anchor.find('ul li p:last')[0].firstChild;$.summernote.core.range.create(node,6).select();click_event(node,'mouseup');}},{content:"click on style dropdown",trigger:'.note-air-popover .note-style button.dropdown-toggle',extra_trigger:'#editable_area > section .row > div:first ul li p:first',},{content:"select h3",trigger:'.note-air-popover .note-style ul:visible a[data-value="h3"]',},{content:"select h3",trigger:'#editable_area > section .row > div:first > ul > li > h3',run:function(){var node=this.$anchor[0].firstChild;$.summernote.core.range.create(node,0).select();click_event(node,'mouseup');}},{content:"double tabulation",trigger:'#editable_area > section .row > div:first > ul > li > h3',run:"keydown 9,9",},{content:"click on order list",trigger:'.note-air-popover button[data-event="insertOrderedList"]',extra_trigger:'#editable_area > section .row > div:first ul > li > ul > li > ul > li > h3',},{content:"select for enter in ul",trigger:'#editable_area > section .row > div:first ul li > p:last',run:function(){this.$anchor[0].firstChild.textContent+="";$.summernote.core.range.create(this.$anchor[0].firstChild,7).select();click_event(this.$anchor[0],'mouseup');}},{content:"enter in ul",trigger:'#editable_area > section .row > div:first ul li > p:last',run:"keydown 66,13",},{trigger:'#editable_area > section .row > div:first ul li > p:eq(1):containsRegex(/^municipium./)',content:"backspace in list",run:"keydown 8",},{content:"end",trigger:'#editable_area > section .row > div:first ul li p:eq(0):containsRegex(/^Batnae Bmunicipium.$/)',}]);tour.register('rte_inline',{url:'/web_editor/field/html/inline?callback=FieldTextHtml_0&enable_editor=1&datarecord=%7B%7D',test:true,wait_for:base.ready(),},[{content:"Change html for this test",trigger:"#editable_area",run:function(){var html='\n'+'<div>\n'+'  <table cellspacing="0" cellpadding="0" width="100%">\n'+'    <tbody>\n'+'      <tr>\n'+'        <td valign="center" width="270">\n'+'          <img src="/logo.png" alt="Your Logo" class="img-circle img-thumbnail">\n'+'        </td>\n'+'        <td valign="center" width="270">\n'+'          <a href="https://www.facebook.com/Odoo"><span class="fa fa-facebook-square fa-2x text-primary"></span></a>\n'+'          <span style="color: rgb(255, 0, 0);" class="fa fa-4x fa-google-plus-square pull-right"></span>\n'+'        </td>\n'+'      </tr>\n'+'    </tbody>\n'+'  </table>\n'+'</div>';this.$anchor.html(html);}},{content:"call clean for save",trigger:'#wrapwrap table',run:function(){snippet_editor.instance.clean_for_save();}},{content:"check the image style",trigger:'#wrapwrap img:first[width][height][style*="-radius"][style*="1px"][style*="padding"]',},{content:"check the font image src",trigger:'#wrapwrap img:eq(1)[src^="/web_editor/font_to_img/"][src$="/rgb(51,122,183)/28"]',},{content:"check the font class to css",trigger:'#wrapwrap img:eq(1)[height]:not([class*="fa"])',},{content:"check the second font class to css",trigger:'#wrapwrap img:eq(2)[style*="float: right"]',}]);});;

/* /web_editor/static/src/js/transcoder.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.transcoder',function(require){'use strict';var widget=require('web_editor.widget');var rulesCache=[];var getMatchedCSSRules=function(a){if(!rulesCache.length){var sheets=document.styleSheets;for(var i=sheets.length-1;i>=0;i--){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(rules){for(var r=rules.length-1;r>=0;r--){var selectorText=rules[r].selectorText;if(selectorText&&rules[r].cssText&&selectorText!=="*"&&selectorText.indexOf(":hover")===-1&&selectorText.indexOf(":before")===-1&&selectorText.indexOf(":after")===-1&&selectorText.indexOf(":active")===-1&&selectorText.indexOf(":link")===-1&&selectorText.indexOf("::")===-1&&selectorText.indexOf("\"")===-1&&selectorText.indexOf("'")===-1){var st=selectorText.split(/\s*,\s*/);for(var k=0;k<st.length;k++){rulesCache.push({'selector':st[k],'style':rules[r].style});}}}}}
rulesCache.reverse();}
var css=[];a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(var r=0;r<rulesCache.length;r++){if(a.matches(rulesCache[r].selector)){var style=rulesCache[r].style;if(style.parentRule){var style_obj={};for(var k=0,len=style.length;k<len;k++){if(style[k].indexOf('animation')!==-1){continue;}
style_obj[style[k]]=style[style[k].replace(/-(.)/g,function(a,b){return b.toUpperCase();})];if(new RegExp(style[k]+'\s*:[^:;]+!important').test(style.cssText)){style_obj[style[k]]+=' !important';}}
rulesCache[r].style=style=style_obj;}
css.push([rulesCache[r].selector,style]);}}
function specificity(selector){var a=0;selector=selector.replace(/#[a-z0-9_-]+/gi,function(){a++;return"";});var b=0;selector=selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,function(){b++;return"";});var c=0;selector=selector.replace(/(^|\s+|:+)[a-z0-9_-]+/gi,function(a){if(a.indexOf(':not(')===-1)c++;return"";});return a*100+b*10+c;}
css.sort(function(a,b){return specificity(a[0])-specificity(b[0]);});var style={};_.each(css,function(v,k){_.each(v[1],function(v,k){if(v&&_.isString(v)&&k.indexOf('-webkit')===-1&&(!style[k]||style[k].indexOf('important')===-1||v.indexOf('important')!==-1)){style[k]=v;}});});_.each(style,function(v,k){if(v.indexOf('important')!==-1){style[k]=v.slice(0,v.length-11);}});if(style.display==='block'){delete style.display;}
_.each(['margin','padding'],function(p){if(style[p+'-top']||style[p+'-right']||style[p+'-bottom']||style[p+'-left']){if(style[p+'-top']===style[p+'-right']&&style[p+'-top']===style[p+'-bottom']&&style[p+'-top']===style[p+'-left']){style[p]=style[p+'-top'];}
else{style[p]=(style[p+'-top']||0)+' '+(style[p+'-right']||0)+' '+(style[p+'-bottom']||0)+' '+(style[p+'-left']||0);if(style[p].indexOf('inherit')!==-1||style[p].indexOf('initial')!==-1){delete style[p];return;}}
delete style[p+'-top'];delete style[p+'-right'];delete style[p+'-bottom'];delete style[p+'-left'];}});if(style['text-decoration-line']){style['text-decoration']=style['text-decoration-line'];delete style['text-decoration-line'];delete style['text-decoration-color'];delete style['text-decoration-style'];}
if(style['text-align']==='inherit'){var $el=$(a).parent();do{var align=$el.css('text-align');if(_.indexOf(['left','right','center','justify'],align)>=0){style['text-align']=align;break;}
$el=$el.parent();}while(!$el.is('html'));}
return style;};var font_to_img=function($editable){$editable.find(".fa").each(function(){var $font=$(this);var icon,content;_.find(widget.fontIcons,function(font){return _.find(widget.getCssSelectors(font.parser),function(css){if($font.is(css[0].replace(/::?before/g,''))){icon=css[2].split("-").shift();content=css[1].match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){var color=$font.css("color").replace(/\s/g,'');$font.replaceWith($("<img/>",{"src":_.str.sprintf('/web_editor/font_to_img/%s/%s/%s',content.charCodeAt(0),window.encodeURI(color),Math.max(1,$font.height())),"data-class":$font.attr("class"),"data-style":$font.attr("style"),"class":$font.attr("class").replace(new RegExp("(^|\\s+)"+icon+"(-[^\\s]+)?","gi"),''),"style":$font.attr("style")}).css({height:"auto",width:"auto"}));}else{$font.remove();}});};var img_to_font=function($editable){$editable.find("img[src*='/web_editor/font_to_img/']").each(function(){var $img=$(this);$img.replaceWith($("<span/>",{"class":$img.data("class"),"style":$img.data("style")}));});};var applyOverDescendants=function(node,func){node=node.firstChild;while(node){if(node.nodeType===1){func(node);applyOverDescendants(node,func);}
node=node.nextSibling;}};var class_to_style=function($editable){if(!rulesCache.length){getMatchedCSSRules($editable[0]);}
applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style=$target.attr("style")||"";_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+":"+v+";"+style;}});if(_.isEmpty(style)){$target.removeAttr("style");}else{$target.attr("style",style);}});};var style_to_class=function($editable){getMatchedCSSRules($editable[0]);var $c=$('<span/>').appendTo("body");applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style="";_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+":"+v+";"+style;}});css=($c.attr("style",style).attr("style")||"").split(/\s*;\s*/);style=$target.attr("style")||"";_.each(css,function(v){style=style.replace(v,'');});style=style.replace(/;+(\s;)*/g,';').replace(/^;/g,'');if(style!==''){$target.attr("style",style);}else{$target.removeAttr("style");}});$c.remove();};return{'font_to_img':font_to_img,'img_to_font':img_to_font,'class_to_style':class_to_style,'style_to_class':style_to_class,};});;

/* /web_editor/static/src/js/translator.js defined in bundle 'web_editor.assets_editor' */
odoo.define('web_editor.translate',function(require){'use strict';var core=require('web.core');var Model=require('web.Model');var ajax=require('web.ajax');var Widget=require('web.Widget');var base=require('web_editor.base');var rte=require('web_editor.rte');var editor_widget=require('web_editor.widget');var _t=core._t;var translatable=!!$('html').data('translatable');var edit_translations=!!$('html').data('edit_translations');$.fn.extend({prependEvent:function(events,selector,data,handler){this.on(events,selector,data,handler);events=events.split(' ');this.each(function(){var el=this;_.each(events,function(event){var handler=$._data(el,'events')[event].pop();$._data(el,'events')[event].unshift(handler);});});return this;}});var RTE_Translate=rte.Class.extend({saveElement:function($el,context){var key=$el.data('oe-translation-id')?'translation:'+$el.data('oe-translation-id'):($el.data('oe-model')?$el.data('oe-model')+":"+$el.data('oe-id')+":"+$el.data('oe-field')+":"+$el.data('oe-type')+":"+$el.data('oe-expression'):false);if(!key||this.__saved[key])return true;this.__saved[key]=true;if($el.data('oe-translation-id')){var translation_content=this.getEscapedElement($el).html();return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.translation',method:'save_html',args:[[+$el.data('oe-translation-id')],translation_content,context||base.get_context()],});}else{var markup=this.getEscapedElement($el).prop('outerHTML');return ajax.jsonRpc('/web/dataset/call','call',{model:'ir.ui.view',method:'save',args:[$el.data('oe-id'),markup,$el.data('oe-xpath')||null,context||base.get_context()],});}},});var Translate_Modal=editor_widget.Dialog.extend({init:function(p,options,parent,node){this._super(p,_.extend({},{title:_t("Translate Attribute"),buttons:[{text:_t("Close"),classes:"btn-primary o_save_button",close:true,click:this.save}]},options||{}));this.parent=parent;this.$target=$(node);this.translation=$(node).data('translation');},start:function(){var self=this;var def=this._super.apply(this,arguments);var $group=$("<div/>",{"class":"form-group"}).appendTo(this.$el);_.each(this.translation,function(node,attr){var $node=$(node);var $label=$('<label class="control-label"></label>').text(attr);var $input=$('<input class="form-control"/>').val($node.html());$input.on('change keyup',function(){var value=$input.val();$node.html(value).trigger('change',node);$node.data('$node').attr($node.data('attribute'),value).trigger('translate');self.parent.rte_changed(node);});$group.append($label).append($input);});return def;}});var Translate=Widget.extend({events:{'click [data-action="save"]':'save_and_reload','click [data-action="cancel"]':'cancel',},template:'web_editor.editorbar',init:function(parent,$target,lang){this.parent=parent;this.ir_translation=new Model('ir.translation');this.lang=lang||base.get_context().lang;this.setTarget($target);this._super.apply(this,arguments);this.rte=new RTE_Translate(this,this.config);this.rte.on('change',this,this.rte_changed);},start:function(){this._super.apply(this,arguments);this.$('#web_editor-toolbars').remove();return this.edit();},setTarget:function($target){var $edit=$target.find('[data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field]');$edit.filter(':has([data-oe-translation-id], [data-oe-model][data-oe-id][data-oe-field])').attr('data-oe-readonly',true);this.$target=$edit.not('[data-oe-readonly]');var attrs=['placeholder','title','alt'];_.each(attrs,function(attr){$target.find('['+attr+'*="data-oe-translation-id="]').filter(':empty, input, select, textarea, img').each(function(){var $node=$(this);var translation=$node.data('translation')||{};var trans=$node.attr(attr);var match=trans.match(/<span [^>]*data-oe-translation-id="([0-9]+)"[^>]*>(.*)<\/span>/);var $trans=$(trans).addClass('hidden o_editable o_editable_translatable_attribute').appendTo('body');$trans.data('$node',$node).data('attribute',attr);translation[attr]=$trans[0];$node.attr(attr,match[2]);var select2=$node.data('select2');if(select2){select2.blur();$node.on('translate',function(){select2.blur();});$node=select2.container.find('input');}
$node.addClass('o_translatable_attribute').data('translation',translation);});});this.$target_attr=$target.find('.o_translatable_attribute');this.$target_attribute=$('.o_editable_translatable_attribute');},find:function(selector){return selector?this.$target.find(selector).addBack().filter(selector):this.$target;},edit:function(){var flag=false;window.onbeforeunload=function(event){if($('.o_editable.o_dirty').length&&!flag){flag=true;setTimeout(function(){flag=false;},0);return _t('This document is not saved!');}};this.$target.addClass("o_editable");this.rte.start();this.translations=[];this.markTranslatableNodes();this.onTranslateReady();},onTranslateReady:function(){this.$el.show();this.trigger("edit");},rte_changed:function(node){var $node=$(node);$node.find("p").each(function(){var $p=$(this);$p.after($p.html()).remove();});var trans=this.getTranlationObject($node[0]);$node.toggleClass('o_dirty',trans.value!==$node.html().replace(/[ \t\n\r]+/,' '));},getTranlationObject:function(node){var $node=$(node);var id=+$node.data('oe-translation-id');if(!id){id=$node.data('oe-model')+','+$node.data('oe-id')+','+$node.data('oe-field');}
var trans=_.find(this.translations,function(trans){return trans.id===id;});if(!trans){this.translations.push(trans={'id':id});}
return trans;},__unbind_click:function(event){if(event.ctrlKey||!$(event.target).is(':o_editable')){return;}
event.preventDefault();event.stopPropagation();},__translate_attribute:function(event){if(event.ctrlKey){return;}
event.preventDefault();event.stopPropagation();if(event.type!=='mousedown'){return;}
new Translate_Modal(null,{},event.data,event.target).open();},markTranslatableNodes:function(node){var self=this;this.$target.add(this.$target_attribute).each(function(){var $node=$(this);var trans=self.getTranlationObject(this);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');});this.$target.parent().prependEvent('click',this,this.__unbind_click);this.$target_attr.each(function(){var $node=$(this);var translation=$node.data('translation');_.each(translation,function(node,attr){var trans=self.getTranlationObject(node);trans.value=(trans.value?trans.value:$node.html()).replace(/[ \t\n\r]+/,' ');$node.attr('data-oe-translation-state',(trans.state||'to_translate'));});});this.$target_attr.prependEvent('mousedown click mouseup',this,this.__translate_attribute);console.info('Click on CTRL when you click in an translatable area to have the default behavior');},unarkTranslatableNode:function(){this.$target.removeClass('o_editable').removeAttr('contentEditable');this.$target.parent().off('click',this.__unbind_click);this.$target_attr.off('mousedown click mouseup',this.__translate_attribute);},save_and_reload:function(){return this.save().then(function(){window.location.href=window.location.href.replace(/&?edit_translations(=[^&]*)?/g,'');});},save:function(){var context=base.get_context();context.lang=this.lang;return this.rte.save(context);},cancel:function(){var self=this;this.rte.cancel();this.$target.each(function(){$(this).html(self.getTranlationObject(this).value);});this.unarkTranslatableNode();this.trigger("cancel");this.$el.hide();window.onbeforeunload=null;},destroy:function(){this.cancel();this.$el.remove();this._super.apply(this,arguments);},config:function($editable){if($editable.data('oe-model')){return{'airMode':true,'focus':false,'airPopover':[['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};}
return{'airMode':true,'focus':false,'airPopover':[['font',['bold','italic','underline','clear']],['fontsize',['fontsize']],['color',['color']],['history',['undo','redo']],],'styleWithSpan':false,'inlinemedia':['p'],'lang':"odoo",'onChange':function(html,$editable){$editable.trigger("content_changed");}};}});if(edit_translations){base.ready().then(function(){data.instance=new Translate(this,$('#wrapwrap'));data.instance.prependTo(document.body);$('a[href*=edit_translations]').each(function(){this.href=this.href.replace(/[$?]edit_translations[^&?]+/,'');});$('form[action*=edit_translations]').each(function(){this.action=this.action.replace(/[$?]edit_translations[^&?]+/,'');});$('title').html($('title').html().replace(/&lt;span data-oe-model.+?&gt;(.+?)&lt;\/span&gt;/,'\$1'));});}
var data={'translatable':translatable,'edit_translations':edit_translations,'Class':Translate,};return data;});